<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NPWV75JM9M"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-NPWV75JM9M');</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Focuz â€” Deep Work Timer</title>
<meta name="theme-color" content="#8b5cf6">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Focuz">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@300;400;500&family=Fraunces:ital,wght@0,700;0,900;1,700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<style>:root{--fD:'Fraunces',Georgia,serif;--fB:'DM Sans',system-ui,sans-serif;--fM:'DM Mono',monospace;--spring:cubic-bezier(0.34,1.56,0.64,1);--out:cubic-bezier(0.16,1,0.3,1);--r-xl:24px;--r-lg:18px;--r-md:12px;--r-sm:8px;--r-pill:999px;--pink:#f472b6;--violet:#8b5cf6;--v2:#7c3aed;--teal:#2dd4bf;--amber:#f59e0b;--green:#10b981;--red:#f87171;--orange:#fb923c;--gh:linear-gradient(135deg,#f472b6,#8b5cf6,#2dd4bf);--gc:linear-gradient(135deg,#8b5cf6,#2dd4bf);--gg:linear-gradient(135deg,#10b981,#2dd4bf)}[data-theme="dark"]{--bg:#07070f;--bg2:#0d0d1a;--bg3:#131320;--card:#14141f;--card2:#1c1c2e;--card3:#22223a;--b1:rgba(255,255,255,0.06);--b2:rgba(255,255,255,0.11);--b3:rgba(255,255,255,0.18);--tx:#f0eeff;--tx2:#9b96c0;--tx3:#4d4870;--sha:rgba(0,0,0,0.7);--shb:rgba(0,0,0,0.35)}[data-theme="light"]{--bg:#f7f6ff;--bg2:#efedff;--bg3:#e8e5ff;--card:#fff;--card2:#f5f3ff;--card3:#ede9fe;--b1:rgba(0,0,0,0.06);--b2:rgba(0,0,0,0.1);--b3:rgba(0,0,0,0.16);--tx:#160d2e;--tx2:#5b4d8a;--tx3:#a898cc;--sha:rgba(107,87,196,0.15);--shb:rgba(107,87,196,0.08);--pink:#db2777;--violet:#6d28d9;--v2:#5b21b6;--teal:#0d9488;--green:#059669}*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}html{scroll-behavior:smooth}body{background:var(--bg);color:var(--tx);font-family:var(--fB);font-size:14px;min-height:100svh;overscroll-behavior:none;-webkit-font-smoothing:antialiased}input,textarea,select{font-size:16px!important}button,a,[role="button"]{-webkit-tap-highlight-color:transparent;touch-action:manipulation}.hidden{display:none!important}.page{display:none;position:relative;z-index:2}.page.active{display:block}#landing.active{display:flex;flex-direction:column;min-height:100svh}#app.active{display:block;max-width:440px;margin:0 auto}#atmos{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}.orb{position:absolute;border-radius:50%;filter:blur(90px);animation:orbF var(--d,20s) ease-in-out infinite alternate}.orb1{width:500px;height:500px;background:radial-gradient(circle,rgba(139,92,246,0.18),transparent 70%);top:-150px;right:-150px;--d:22s}.orb2{width:400px;height:400px;background:radial-gradient(circle,rgba(244,114,182,0.13),transparent 70%);bottom:-100px;left:-100px;--d:18s}.orb3{width:300px;height:300px;background:radial-gradient(circle,rgba(45,212,191,0.09),transparent 70%);top:40%;left:10%;--d:25s}[data-theme="light"] .orb1{background:radial-gradient(circle,rgba(139,92,246,0.07),transparent 70%)}[data-theme="light"] .orb2{background:radial-gradient(circle,rgba(244,114,182,0.05),transparent 70%)}[data-theme="light"] .orb3{background:radial-gradient(circle,rgba(45,212,191,0.04),transparent 70%)}@keyframes orbF{from{transform:translate(0,0)}to{transform:translate(35px,25px) scale(1.1)}}@keyframes gFlow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes scaleIn{from{opacity:0;transform:scale(0.85)}to{opacity:1;transform:scale(1)}}@keyframes slideUp{from{opacity:0;transform:translateY(60px)}to{opacity:1;transform:translateY(0)}}@keyframes popIn{0%{opacity:0;transform:scale(0.6)}70%{transform:scale(1.08)}100%{opacity:1;transform:scale(1)}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}@keyframes spin{to{transform:rotate(360deg)}}@keyframes waveform{0%,100%{transform:scaleY(0.3)}50%{transform:scaleY(1)}}@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}@keyframes flashNum{0%{opacity:0;transform:scale(0.7)}40%{opacity:1;transform:scale(1.05)}100%{opacity:1;transform:scale(1)}}@keyframes timerPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.016)}}@keyframes glowRing{0%,100%{box-shadow:0 0 20px rgba(139,92,246,0.3)}50%{box-shadow:0 0 50px rgba(139,92,246,0.7),0 0 80px rgba(45,212,191,0.2)}}@keyframes heartbeat{0%,100%{transform:scale(1)}14%{transform:scale(1.12)}28%{transform:scale(1)}42%{transform:scale(1.06)}70%{transform:scale(1)}}@keyframes bump{0%{opacity:0;transform:translateY(8px)}100%{opacity:1;transform:translateY(0)}}@keyframes ripple{from{transform:scale(0);opacity:0.5}to{transform:scale(4);opacity:0}}@keyframes supportGlow{0%,100%{box-shadow:0 0 12px rgba(245,158,11,0.25)}50%{box-shadow:0 0 28px rgba(245,158,11,0.55)}}@keyframes colorFlash{0%{opacity:0;transform:scale(0.85)}60%{transform:scale(1.04)}100%{opacity:1;transform:scale(1)}}.grad-text{background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.reveal{opacity:0;transform:translateY(18px);transition:opacity 0.6s var(--out),transform 0.6s var(--out)}.reveal.visible{opacity:1;transform:translateY(0)}.ripple-wrap{position:relative;overflow:hidden}.ripple-el{position:absolute;border-radius:50%;background:rgba(255,255,255,0.22);animation:ripple 0.6s ease-out forwards;pointer-events:none}.theme-btn{width:52px;height:28px;background:var(--card2);border:1.5px solid var(--b2);border-radius:var(--r-pill);cursor:pointer;display:flex;align-items:center;padding:3px;transition:all 0.3s;flex-shrink:0}.theme-knob{width:20px;height:20px;border-radius:50%;background:var(--gc);display:flex;align-items:center;justify-content:center;font-size:11px;transition:transform 0.4s var(--spring);flex-shrink:0}[data-theme="light"] .theme-knob{transform:translateX(24px)}.t-d{display:flex}.t-l{display:none}[data-theme="light"] .t-d{display:none}[data-theme="light"] .t-l{display:flex}.auth-wrap{position:fixed;inset:0;z-index:500;display:flex;align-items:center;justify-content:center;padding:20px}.auth-bg{position:absolute;inset:0;background:rgba(7,7,15,0.92);backdrop-filter:blur(20px)}[data-theme="light"] .auth-bg{background:rgba(247,246,255,0.92)}.auth-card{position:relative;z-index:1;background:var(--card);border:1px solid var(--b2);border-radius:28px;padding:32px 24px 24px;max-width:380px;width:100%;box-shadow:0 40px 100px var(--sha);animation:scaleIn 0.35s var(--spring)}.auth-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border-radius:28px 28px 0 0}.auth-logo{font-family:var(--fD);font-size:42px;font-weight:900;font-style:italic;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-align:center;margin-bottom:4px}.auth-tag{font-size:12px;color:var(--tx3);text-align:center;margin-bottom:20px}.auth-tabs{display:flex;gap:5px;background:var(--bg3);border-radius:var(--r-md);padding:4px;margin-bottom:14px}.auth-tab{flex:1;border:none;border-radius:var(--r-sm);padding:10px;font-family:var(--fB);font-size:13px;font-weight:700;color:var(--tx3);background:transparent;cursor:pointer;transition:all 0.2s}.auth-tab.on{background:var(--card);color:var(--tx);box-shadow:0 2px 8px var(--shb)}.auth-msg{border-radius:var(--r-md);padding:10px 14px;font-size:12px;margin-bottom:12px;line-height:1.5}.auth-msg.err{background:rgba(248,113,113,0.1);border:1px solid rgba(248,113,113,0.3);color:var(--red)}.auth-msg.ok{background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);color:var(--green)}.auth-in{width:100%;background:var(--bg3);border:1.5px solid var(--b2);border-radius:var(--r-md);padding:13px 16px;font-family:var(--fB);color:var(--tx);outline:none;transition:border-color 0.2s;margin-bottom:10px;display:block}.auth-in:focus{border-color:var(--v2)}.auth-in::placeholder{color:var(--tx3)}.auth-submit{width:100%;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border:none;border-radius:var(--r-lg);padding:14px;font-family:var(--fB);font-size:15px;font-weight:700;color:#fff;cursor:pointer;box-shadow:0 8px 28px rgba(139,92,246,0.4);margin-bottom:14px;transition:opacity 0.2s}.auth-submit:active{opacity:.85}.auth-submit:disabled{opacity:.5;cursor:not-allowed}.auth-divider{display:flex;align-items:center;gap:10px;color:var(--tx3);margin-bottom:10px}.auth-divider::before,.auth-divider::after{content:'';flex:1;height:1px;background:var(--b1)}.auth-divider span{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.1em}.guest-warn{background:rgba(251,146,60,0.08);border:1px solid rgba(251,146,60,0.25);border-radius:var(--r-md);padding:10px 13px;margin-bottom:10px;display:flex;gap:8px;align-items:flex-start}.gw-ico{font-size:14px;flex-shrink:0;margin-top:1px}.gw-txt{font-size:11px;color:var(--tx2);line-height:1.6}.gw-txt strong{color:var(--orange)}.auth-guest{width:100%;background:transparent;border:1.5px solid var(--b3);border-radius:var(--r-lg);padding:11px;font-family:var(--fB);font-size:13px;font-weight:600;color:var(--tx3);cursor:pointer;transition:all 0.2s}.ob-wrap{position:fixed;inset:0;z-index:600;display:flex;align-items:center;justify-content:center;padding:24px;background:rgba(7,7,15,0.97);backdrop-filter:blur(20px)}.ob-card{background:var(--card);border:1px solid var(--b2);border-radius:28px;padding:36px 28px 28px;max-width:380px;width:100%;position:relative;overflow:hidden;box-shadow:0 40px 100px rgba(0,0,0,0.8);animation:scaleIn 0.4s var(--spring)}.ob-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border-radius:28px 28px 0 0}.ob-skip{position:absolute;top:16px;right:20px;font-size:12px;font-weight:700;color:var(--tx3);cursor:pointer;padding:6px}.ob-ico{font-size:54px;text-align:center;margin-bottom:18px}.ob-title{font-family:var(--fD);font-size:26px;font-weight:900;letter-spacing:-0.5px;text-align:center;margin-bottom:12px}.ob-brand{background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.ob-desc{font-size:14px;color:var(--tx2);line-height:1.75;text-align:center;margin-bottom:28px}.ob-next{width:100%;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border:none;border-radius:var(--r-lg);padding:15px;font-family:var(--fB);font-size:15px;font-weight:700;color:#fff;cursor:pointer;box-shadow:0 8px 28px rgba(139,92,246,0.4);margin-bottom:20px}.ob-dots{display:flex;justify-content:center;gap:8px}.ob-dot{width:8px;height:8px;border-radius:50%;background:var(--card3);transition:all 0.3s var(--spring)}.ob-dot.on{background:var(--violet);width:22px;border-radius:99px}.land-nav{position:sticky;top:0;z-index:80;padding:14px 24px;display:flex;align-items:center;justify-content:space-between;background:rgba(7,7,15,0.85);backdrop-filter:blur(24px);border-bottom:1px solid var(--b1)}[data-theme="light"] .land-nav{background:rgba(247,246,255,0.9)}.land-logo{font-family:var(--fD);font-size:22px;font-weight:900;font-style:italic;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.nav-r{display:flex;align-items:center;gap:10px}.nav-cta{background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border:none;border-radius:var(--r-pill);padding:9px 20px;font-family:var(--fB);font-size:13px;font-weight:700;color:#fff;cursor:pointer}.land-hero{flex:1;display:flex;flex-direction:column;align-items:center;padding:60px 24px 48px;text-align:center;max-width:640px;margin:0 auto;width:100%}.eyebrow{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--b2);background:var(--card);border-radius:var(--r-pill);padding:6px 16px;font-size:11px;font-weight:700;color:var(--violet);margin-bottom:24px;text-transform:uppercase;letter-spacing:0.06em}.edot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:pulse 2s ease infinite}.hero-h1{font-family:var(--fD);font-size:clamp(40px,10vw,72px);font-weight:900;line-height:1.05;letter-spacing:-2px;margin-bottom:18px}.hero-sub{font-size:15px;color:var(--tx2);line-height:1.75;max-width:440px;margin:0 auto 36px}.btn-hero{background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border:none;border-radius:var(--r-lg);padding:16px 36px;font-family:var(--fB);font-size:16px;font-weight:700;color:#fff;cursor:pointer;box-shadow:0 8px 32px rgba(139,92,246,0.45);margin-bottom:48px}.feat-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;width:100%;margin-bottom:48px}.feat-tile{background:var(--card);border:1px solid var(--b1);border-radius:var(--r-xl);padding:20px 16px;text-align:left}.fi{font-size:22px;margin-bottom:10px}.fn{font-size:13px;font-weight:700;color:var(--tx);margin-bottom:4px}.fd{font-size:11px;color:var(--tx3);line-height:1.6}.land-cta-box{background:var(--card);border:1px solid var(--b2);border-radius:28px;padding:44px 28px;text-align:center;width:100%;margin-bottom:16px;position:relative;overflow:hidden}.land-cta-box::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite}.cta-h{font-family:var(--fD);font-size:clamp(24px,5vw,36px);font-weight:900;letter-spacing:-1px;margin-bottom:10px}.cta-s{font-size:13px;color:var(--tx2);margin-bottom:28px;line-height:1.7}.land-foot{text-align:center;padding:10px 24px 36px;font-size:11px;color:var(--tx3)}.land-links{display:flex;gap:18px;justify-content:center;padding:0 24px 10px;flex-wrap:wrap}.land-link{font-size:11px;color:var(--tx3);cursor:pointer;text-decoration:underline;text-underline-offset:3px}.topbar{position:sticky;top:0;z-index:60;padding:12px 18px;display:flex;align-items:center;justify-content:space-between;background:rgba(7,7,15,0.92);backdrop-filter:blur(28px);border-bottom:1px solid var(--b1)}[data-theme="light"] .topbar{background:rgba(247,246,255,0.92)}.app-logo{font-family:var(--fD);font-size:20px;font-weight:900;font-style:italic;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;cursor:pointer}.topbar-r{display:flex;align-items:center;gap:8px;position:relative}.streak-badge{background:var(--card2);border:1.5px solid var(--b2);border-radius:var(--r-pill);padding:5px 11px;font-size:12px;font-weight:700;color:var(--amber)}.sdot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:pulse 2s ease infinite;flex-shrink:0}.sdot.off{background:var(--tx3);animation:none}.sdot.syncing{background:var(--amber);animation:spin 1s linear infinite;border-radius:2px}.signin-btn{background:var(--card2);border:1.5px solid var(--b2);border-radius:var(--r-pill);padding:6px 13px;font-family:var(--fB);font-size:12px;font-weight:700;color:var(--violet);cursor:pointer}.user-pill{display:flex;align-items:center;gap:6px;background:var(--card2);border:1.5px solid var(--b2);border-radius:var(--r-pill);padding:4px 11px 4px 5px;cursor:pointer}.user-av{width:22px;height:22px;border-radius:50%;background:var(--gc);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:#fff;flex-shrink:0}.user-nm{font-size:11px;font-weight:700;color:var(--tx);max-width:65px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.user-menu{position:absolute;top:48px;right:0;background:var(--card);border:1px solid var(--b2);border-radius:var(--r-xl);padding:6px;min-width:150px;box-shadow:0 20px 60px var(--sha);z-index:100;animation:fadeUp 0.2s var(--spring)}.um-item{display:flex;align-items:center;gap:9px;padding:11px 13px;border-radius:var(--r-md);cursor:pointer;font-size:13px;font-weight:600;color:var(--red)}.quote-strip{margin:14px 18px 0;background:var(--card);border:1px solid var(--b1);border-radius:var(--r-xl);padding:13px 16px;display:flex;gap:11px;position:relative;overflow:hidden}.quote-strip::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--gc);border-radius:99px}.qs-mark{font-family:Georgia,serif;font-size:34px;line-height:0.75;color:var(--violet);opacity:.25;flex-shrink:0;margin-top:4px}.qs-text{font-size:12px;font-style:italic;color:var(--tx2);line-height:1.65}.qs-auth{font-size:10px;font-weight:700;color:var(--violet);margin-top:4px}.guest-banner{margin:12px 18px 0;background:rgba(251,146,60,0.08);border:1px solid rgba(251,146,60,0.22);border-radius:var(--r-lg);padding:11px 14px;display:flex;align-items:center;gap:10px}.gb-txt{flex:1;font-size:11px;color:var(--tx2);line-height:1.5}.gb-txt strong{color:var(--orange);display:block;margin-bottom:2px}.gb-btn{background:var(--orange);border:none;border-radius:var(--r-pill);padding:7px 14px;font-family:var(--fB);font-size:11px;font-weight:700;color:#fff;cursor:pointer;white-space:nowrap;flex-shrink:0}.streak-hero{margin:12px 18px 0;background:var(--card);border:1px solid var(--b1);border-radius:var(--r-xl);padding:16px 18px;display:flex;align-items:center;justify-content:space-between}.streak-l{display:flex;align-items:center;gap:12px}.streak-count{font-family:var(--fD);font-size:26px;font-weight:900;color:var(--amber);line-height:1}.streak-lbl{font-size:10px;color:var(--tx3);font-weight:600;margin-top:2px;text-transform:uppercase;letter-spacing:0.06em}.week-dots{display:flex;gap:6px;align-items:flex-end}.wd-col{display:flex;flex-direction:column;align-items:center;gap:3px}.wd{width:9px;height:9px;border-radius:50%;background:var(--card3);transition:all 0.3s}.wd.on{background:var(--amber)}.wd.today{background:var(--violet);box-shadow:0 0 8px rgba(139,92,246,0.6)}.wd-lbl{font-size:8px;color:var(--tx3);font-weight:700}.intention-card{margin:12px 18px 0;background:var(--card);border:1.5px solid var(--b1);border-radius:var(--r-xl);padding:16px 18px;transition:border-color .25s,box-shadow .25s;position:relative;overflow:hidden}.intention-card:focus-within{border-color:var(--v2);box-shadow:0 0 0 3px rgba(124,58,237,0.12)}.intention-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1.5px;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;opacity:0;transition:opacity .3s}.intention-card:focus-within::before{opacity:1}.int-lbl{font-size:10px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}.int-cnt{font-family:var(--fM);font-size:9px;font-weight:400;color:var(--tx3);text-transform:none;letter-spacing:0;transition:color .2s}.int-cnt.warn{color:var(--orange)}.int-cnt.full{color:var(--red)}.int-in{width:100%;background:transparent;border:none;outline:none;font-family:var(--fD);font-size:17px;font-weight:700;color:var(--tx);font-style:italic}.int-in::placeholder{color:var(--tx3);font-weight:500}.sound-suggest{display:none;margin-top:10px;background:rgba(45,212,191,0.08);border:1px solid rgba(45,212,191,0.25);border-radius:var(--r-pill);padding:7px 16px;font-size:12px;font-weight:600;color:var(--teal);cursor:pointer;width:100%;text-align:left}.task-panel{margin:12px 18px 0;background:var(--card);border:1px solid var(--b1);border-radius:var(--r-xl);overflow:hidden}.task-panel-head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;cursor:pointer}.task-head-r{display:flex;align-items:center;gap:8px}.task-cnt{background:rgba(139,92,246,0.12);border:1px solid rgba(139,92,246,0.25);color:var(--violet);border-radius:var(--r-pill);padding:2px 9px;font-size:11px;font-weight:700}.task-panel-arr{font-size:11px;color:var(--tx3);transition:transform .25s}.task-panel-arr.open{transform:rotate(180deg)}.task-body{padding:0 14px 14px;display:none}.task-body.open{display:block}.task-add-row{display:flex;gap:8px;margin-bottom:10px}.task-in{flex:1;background:var(--bg3);border:1.5px solid var(--b2);border-radius:var(--r-md);padding:11px 13px;font-family:var(--fB);color:var(--tx);outline:none;transition:border-color .2s}.task-in:focus{border-color:var(--v2)}.task-add-btn{width:44px;height:44px;flex-shrink:0;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border:none;border-radius:var(--r-md);font-size:22px;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 16px rgba(139,92,246,0.35)}.task-add-btn:active{transform:scale(0.88)}.task-prio-row{display:flex;gap:6px;margin-bottom:12px}.prio-chip{background:var(--bg3);border:1.5px solid var(--b2);border-radius:var(--r-pill);padding:5px 12px;font-size:11px;font-weight:600;color:var(--tx3);cursor:pointer;transition:all .18s}.prio-chip.on[data-p="high"]{border-color:var(--red);color:var(--red);background:rgba(248,113,113,0.1)}.prio-chip.on[data-p="mid"]{border-color:var(--orange);color:var(--orange);background:rgba(251,146,60,0.1)}.prio-chip.on[data-p="low"]{border-color:var(--green);color:var(--green);background:rgba(16,185,129,0.1)}.task-list{display:flex;flex-direction:column;gap:6px}.task-empty{text-align:center;padding:18px;font-size:12px;color:var(--tx3)}.task-item{background:var(--bg3);border:1.5px solid var(--b1);border-radius:var(--r-md);padding:11px 12px;display:flex;align-items:center;gap:10px;cursor:pointer;transition:all .2s;animation:fadeUp .22s var(--spring)}.task-item.ti-focus{border-color:var(--v2);background:rgba(139,92,246,0.07)}.task-item.ti-done{opacity:.4}.task-item.ti-done .ti-name{text-decoration:line-through}.ti-check{width:20px;height:20px;border-radius:50%;border:2px solid var(--b3);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:10px;transition:all .2s var(--spring)}.ti-done .ti-check{background:var(--green);border-color:var(--green);color:#fff}.ti-body{flex:1;min-width:0}.ti-name{font-size:13px;font-weight:600;color:var(--tx);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ti-prio{font-size:9px;font-weight:700;border-radius:4px;padding:2px 6px;text-transform:uppercase;margin-top:3px;display:inline-block}.tp-h{background:rgba(248,113,113,0.12);color:var(--red)}.tp-m{background:rgba(251,146,60,0.12);color:var(--orange)}.tp-l{background:rgba(16,185,129,0.12);color:var(--green)}.ti-del{background:none;border:none;cursor:pointer;color:var(--tx3);font-size:17px;line-height:1;padding:4px;flex-shrink:0}.ti-focus-badge{font-size:10px;font-weight:700;background:rgba(139,92,246,0.15);color:var(--violet);border:1px solid rgba(139,92,246,0.3);border-radius:var(--r-sm);padding:2px 7px;flex-shrink:0;white-space:nowrap}.presets-card{margin:12px 18px 0}.sec-lbl{font-size:10px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:10px}.presets-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}.preset{background:var(--card);border:1.5px solid var(--b2);border-radius:var(--r-lg);padding:14px 6px;text-align:center;cursor:pointer;transition:all .2s var(--spring)}.preset:active{transform:scale(0.88)}.preset.on{border-color:var(--v2);background:rgba(139,92,246,0.1);box-shadow:0 0 0 1px var(--v2),0 4px 16px rgba(139,92,246,0.2)}.preset-min{font-family:var(--fD);font-size:20px;font-weight:900;color:var(--tx);line-height:1}.preset.on .preset-min{color:var(--violet)}.preset-sub{font-size:9px;color:var(--tx3);margin-top:2px;font-weight:600}.custom-row{display:flex;align-items:center;gap:10px;margin-top:8px;background:var(--card);border:1.5px solid var(--b1);border-radius:var(--r-lg);padding:12px 16px}.custom-row.on{border-color:var(--v2);background:rgba(139,92,246,0.06)}.cr-lbl{font-size:12px;color:var(--tx3);font-weight:600}.cr-in{flex:1;background:transparent;border:none;outline:none;font-family:var(--fM);color:var(--tx)}.cr-unit{font-size:12px;color:var(--tx3)}.sound-card{margin:12px 18px 0}.sound-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:7px}.sound-btn{background:var(--card);border:1.5px solid var(--b2);border-radius:var(--r-lg);padding:12px 4px;text-align:center;cursor:pointer;transition:all .2s}.sound-btn:active{transform:scale(0.88)}.sound-btn.on{border-color:var(--amber);background:rgba(245,158,11,0.1);box-shadow:0 0 0 1px var(--amber),0 4px 14px rgba(245,158,11,0.2)}.s-ico{font-size:18px;display:block;margin-bottom:4px}.s-name{font-size:9px;font-weight:700;color:var(--tx3)}.sound-btn.on .s-name{color:var(--amber)}.timer-card{margin:14px 18px 0;background:var(--card);border:1px solid var(--b1);border-radius:28px;padding:24px 18px 20px;display:flex;flex-direction:column;align-items:center;position:relative;overflow:hidden;box-shadow:0 20px 60px var(--sha);transition:box-shadow .4s}.timer-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1.5px;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite}.timer-card.running{box-shadow:0 20px 60px var(--sha),0 0 0 1px rgba(139,92,246,0.15)}.focus-pill{border-radius:var(--r-pill);padding:7px 18px;font-size:12px;font-weight:700;margin-bottom:18px;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;transition:all .3s}.fp-e{background:var(--bg3);border:1px solid var(--b1);color:var(--tx3)}.fp-a{background:rgba(139,92,246,0.12);border:1px solid rgba(139,92,246,0.25);color:var(--violet)}.ring-wrap{position:relative;width:200px;height:200px;display:flex;align-items:center;justify-content:center;margin-bottom:18px}.ring-svg{position:absolute;top:0;left:0;transform:rotate(-90deg)}.r-track{fill:none;stroke:var(--card3);stroke-width:8}.r-glow{fill:none;stroke:url(#rGrad);stroke-width:14;stroke-linecap:round;filter:blur(8px);opacity:.15;transition:stroke-dashoffset 1s linear}.r-prog{fill:none;stroke:url(#rGrad);stroke-width:8;stroke-linecap:round;transition:stroke-dashoffset 1s linear}.ring-center{position:relative;z-index:1;text-align:center}.ring-digits{font-family:var(--fM);font-size:50px;font-weight:300;letter-spacing:-3px;line-height:1;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.ring-status{font-size:9px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:0.14em;margin-top:6px}.viz{display:flex;align-items:center;gap:3px;margin-bottom:18px;height:18px}.vbar{width:3px;border-radius:99px;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;transform-origin:bottom}.vbar.live{animation:gFlow 5s ease infinite,waveform var(--spd,.6s) ease-in-out infinite}.vbar:not(.live){height:3px!important;opacity:.25}.t-controls{display:flex;align-items:center;justify-content:center;gap:14px}.t-btn{width:48px;height:48px;border-radius:50%;background:var(--card2);border:1.5px solid var(--b2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:17px;color:var(--tx3);transition:all .2s var(--spring)}.t-btn:active{transform:scale(0.82)}.t-play{width:68px;height:68px;font-size:24px;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border:none;color:#fff;box-shadow:0 8px 28px rgba(139,92,246,0.5)}.t-play.playing{animation:gFlow 5s ease infinite,glowRing 2s ease-in-out infinite!important}.pomo-row{display:flex;align-items:center;justify-content:space-between;padding:12px 0 0;border-top:1px solid var(--b1);margin-top:12px;width:100%}.pomo-l{display:flex;align-items:center;gap:10px;flex-wrap:wrap}.pomo-lbl{font-size:12px;font-weight:600;color:var(--tx3)}.pomo-cycles{display:flex;gap:4px}.pomo-cyc{font-size:14px;opacity:.25;transition:all .3s}.pomo-cyc.done{opacity:1}.pomo-cyc.cur{opacity:1;animation:heartbeat 1.5s ease infinite}.tog{position:relative;width:44px;height:25px;flex-shrink:0}.tog input{opacity:0;width:0;height:0;position:absolute}.tog-track{position:absolute;inset:0;border-radius:99px;background:var(--card3);border:1.5px solid var(--b2);cursor:pointer;transition:all .3s var(--spring)}.tog input:checked+.tog-track{background:var(--v2);border-color:var(--v2)}.tog-track::after{content:'';position:absolute;top:3px;left:3px;width:15px;height:15px;border-radius:50%;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.3);transition:transform .3s var(--spring)}.tog input:checked+.tog-track::after{transform:translateX(19px)}.break-overlay{position:fixed;inset:0;z-index:180;display:flex;align-items:center;justify-content:center;padding:24px;background:rgba(7,7,15,0.9);backdrop-filter:blur(20px)}.break-card{background:var(--card);border:1.5px solid rgba(16,185,129,0.3);border-radius:28px;padding:32px 24px;text-align:center;max-width:340px;width:100%;box-shadow:0 40px 100px var(--sha);animation:scaleIn .35s var(--spring);position:relative}.break-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--gg);background-size:200%;animation:gFlow 5s ease infinite;border-radius:28px 28px 0 0}.break-emoji{font-size:48px;display:block;margin-bottom:12px;animation:heartbeat 2s ease infinite}.break-title{font-family:var(--fD);font-size:24px;font-weight:900;margin-bottom:6px}.break-msg{font-size:13px;color:var(--tx2);margin-bottom:22px;line-height:1.6}.break-ring-wrap{position:relative;width:140px;height:140px;display:flex;align-items:center;justify-content:center;margin:0 auto 22px}.break-digits{position:absolute;font-family:var(--fM);font-size:32px;font-weight:300;color:var(--green)}.break-btns{display:flex;flex-direction:column;gap:9px}.brk-skip{background:var(--gg);background-size:200%;animation:gFlow 5s ease infinite;border:none;border-radius:var(--r-lg);padding:13px;font-family:var(--fB);font-size:14px;font-weight:700;color:#fff;cursor:pointer}.brk-pause{background:transparent;border:1.5px solid var(--b3);border-radius:var(--r-lg);padding:11px;font-family:var(--fB);font-size:13px;font-weight:600;color:var(--tx3);cursor:pointer}.stats-3{display:grid;grid-template-columns:repeat(3,1fr);gap:9px;margin:14px 18px 0}.stat-card{background:var(--card);border:1px solid var(--b1);border-radius:var(--r-xl);padding:14px 9px;text-align:center}.stat-num{font-family:var(--fD);font-size:26px;font-weight:900;letter-spacing:-1px}.stats-3 .stat-card:nth-child(1) .stat-num{color:var(--pink)}.stats-3 .stat-card:nth-child(2) .stat-num{color:var(--teal)}.stats-3 .stat-card:nth-child(3) .stat-num{color:var(--amber)}.stat-lbl{font-size:9px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:0.08em;margin-top:3px}.chart-card{margin:14px 18px 0;background:var(--card);border:1px solid var(--b1);border-radius:var(--r-xl);padding:18px}.chart-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.chart-title{font-size:14px;font-weight:700;color:var(--tx)}.chart-week-total{font-size:11px;font-weight:700;color:var(--violet)}.chart-bars{display:flex;align-items:flex-end;gap:6px;height:80px;margin-bottom:6px}.chart-bar-wrap{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;height:100%;justify-content:flex-end}.chart-bar{width:100%;border-radius:4px 4px 0 0;min-height:3px;background:linear-gradient(to top,var(--violet),var(--pink));opacity:.6;transition:height .6s var(--spring)}.chart-bar.today{opacity:1;box-shadow:0 0 12px rgba(139,92,246,0.4)}.chart-bar.empty{background:var(--card3);opacity:1}.chart-bar-val{font-family:var(--fM);font-size:9px;color:var(--tx3)}.chart-days{display:flex;gap:6px;margin-bottom:12px}.chart-day-lbl{flex:1;text-align:center;font-size:10px;font-weight:600;color:var(--tx3)}.chart-day-lbl.today{color:var(--violet);font-weight:700}.chart-foot{display:flex;align-items:center;justify-content:space-between}.chart-foot-item{font-size:11px;color:var(--tx3);display:flex;align-items:center;gap:5px}.cf-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.history-card{margin:14px 18px 0;background:var(--card);border:1px solid var(--b1);border-radius:var(--r-xl);overflow:hidden}.hist-head{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;cursor:pointer}.hist-head-t{font-size:14px;font-weight:700;color:var(--tx)}.hist-arr{font-size:16px;color:var(--tx3);transition:transform .3s}.hist-arr.open{transform:rotate(180deg)}.hist-body{padding:0 18px 18px;display:none}.hist-body.open{display:block}.cal-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding-top:4px}.cal-month{font-family:var(--fD);font-size:15px;font-weight:900;color:var(--tx)}.cal-arr{width:28px;height:28px;border-radius:50%;background:var(--card2);border:1px solid var(--b2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;color:var(--tx3)}.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px}.cal-hdr{text-align:center;font-size:9px;font-weight:700;color:var(--tx3);text-transform:uppercase;padding:4px 0}.cal-day{aspect-ratio:1;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;color:var(--tx3);cursor:pointer;position:relative}.cal-day.has{color:var(--tx);background:rgba(139,92,246,0.15)}.cal-day.today{color:var(--violet);font-weight:900;border:1.5px solid rgba(139,92,246,0.4)}.cal-day.sel{background:var(--v2)!important;color:#fff!important}.cal-dot{position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:3px;height:3px;border-radius:50%;background:var(--teal)}.cal-detail{margin-top:12px;background:var(--bg3);border-radius:var(--r-lg);padding:12px 14px;display:none}.cd-date{font-size:11px;font-weight:700;color:var(--violet);margin-bottom:8px}.cd-row{display:flex;align-items:center;gap:9px;padding:7px 0;border-bottom:1px solid var(--b1)}.cd-row:last-child{border-bottom:none}.cd-mins{font-family:var(--fM);font-size:11px;color:var(--teal);flex-shrink:0}.cd-task{font-size:12px;font-weight:600;color:var(--tx);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.weekly-cta{margin:14px 18px 0;display:flex;align-items:center;justify-content:space-between;background:var(--card);border:1.5px solid var(--b2);border-radius:var(--r-xl);padding:15px 18px;cursor:pointer;transition:border-color .2s}.wc-l{display:flex;align-items:center;gap:12px}.wc-ico{font-size:22px}.wc-t{font-size:13px;font-weight:700;color:var(--tx)}.wc-s{font-size:11px;color:var(--tx3);margin-top:2px}.wc-arr{font-size:18px;color:var(--tx3)}#weeklyModal{position:fixed;inset:0;z-index:300;display:flex;align-items:flex-end;justify-content:center}.wm-bg{position:absolute;inset:0;background:rgba(7,7,15,0.8);backdrop-filter:blur(12px)}.wm-sheet{position:relative;z-index:1;background:var(--card);border-radius:28px 28px 0 0;padding:24px 22px 44px;width:100%;max-width:440px;animation:slideUp .35s var(--spring);max-height:88vh;overflow-y:auto}.wm-handle{width:40px;height:4px;border-radius:99px;background:var(--b3);margin:0 auto 20px}.wm-close{position:absolute;top:14px;right:16px;width:30px;height:30px;border-radius:50%;background:var(--card2);border:1px solid var(--b2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:13px;color:var(--tx3)}.wm-title{font-family:var(--fD);font-size:22px;font-weight:900;margin-bottom:4px}.wm-range{font-size:12px;color:var(--tx3);margin-bottom:20px}.recap-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:18px}.rg-card{background:var(--card2);border:1px solid var(--b1);border-radius:var(--r-xl);padding:14px;text-align:center}.rg-num{font-family:var(--fD);font-size:22px;font-weight:900}.rg-card:nth-child(1) .rg-num{color:var(--violet)}.rg-card:nth-child(2) .rg-num{color:var(--teal)}.rg-card:nth-child(3) .rg-num{color:var(--amber)}.rg-card:nth-child(4) .rg-num{color:var(--green)}.rg-lbl{font-size:10px;color:var(--tx3);font-weight:600;text-transform:uppercase;margin-top:3px}.recap-bars{margin-bottom:20px}.rb-lbl{font-size:11px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:10px}.rb-row{display:flex;align-items:center;gap:9px;margin-bottom:6px}.rb-day{font-size:10px;font-weight:700;color:var(--tx3);width:22px;flex-shrink:0}.rb-track{flex:1;height:14px;background:var(--card3);border-radius:99px;overflow:hidden}.rb-bar{height:100%;border-radius:99px;background:var(--gc);transition:width .6s var(--spring)}.rb-val{font-size:10px;color:var(--tx3);width:18px;text-align:right;flex-shrink:0}.recap-share-btn{width:100%;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border:none;border-radius:14px;padding:14px;font-family:var(--fB);font-size:14px;font-weight:700;color:#fff;cursor:pointer}.badges-wrap{margin:14px 18px 0}.badges-title{font-size:14px;font-weight:700;color:var(--tx);margin-bottom:12px}.badges-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}.badge-tile{background:var(--card);border:1px solid var(--b1);border-radius:var(--r-xl);padding:14px 8px;text-align:center}.badge-tile.earned{border-color:var(--amber);background:rgba(245,158,11,0.07)}.badge-tile.locked{opacity:.32;filter:grayscale(0.7)}.b-ico{font-size:26px;margin-bottom:5px;display:block}.b-name{font-size:9px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:0.03em;line-height:1.3}.badge-tile.earned .b-name{color:var(--amber)}.game-launcher{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:8px 0 0}.game-tile{background:var(--card);border:1.5px solid var(--b2);border-radius:var(--r-xl);padding:18px 14px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}.game-tile:active{transform:scale(0.95)}.game-tile::before{content:'';position:absolute;top:0;left:0;right:0;height:1.5px}.game-tile:nth-child(1)::before{background:linear-gradient(90deg,var(--violet),var(--teal))}.game-tile:nth-child(2)::before{background:linear-gradient(90deg,var(--pink),var(--orange))}.game-tile:nth-child(3)::before{background:linear-gradient(90deg,var(--amber),var(--green))}.gt-ico{font-size:28px;display:block;margin-bottom:8px}.gt-name{font-size:13px;font-weight:700;color:var(--tx);margin-bottom:3px}.gt-sub{font-size:10px;color:var(--tx3);line-height:1.5}.gt-hi{font-size:10px;font-weight:700;color:var(--violet);margin-top:6px}.game-modal-wrap{position:fixed;inset:0;z-index:300;display:flex;align-items:center;justify-content:center;padding:20px;background:rgba(7,7,15,0.92);backdrop-filter:blur(16px)}.gm-card{background:var(--card);border:1px solid var(--b2);border-radius:28px;padding:28px 22px;max-width:360px;width:100%;text-align:center;position:relative;animation:scaleIn .3s var(--spring);box-shadow:0 40px 100px var(--sha);max-height:90vh;overflow-y:auto}.gm-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border-radius:28px 28px 0 0}.gm-x{position:absolute;top:14px;right:14px;width:30px;height:30px;border-radius:50%;background:var(--card2);border:1px solid var(--b2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:13px;color:var(--tx3)}.gs-title{font-family:var(--fD);font-size:24px;font-weight:900;margin-bottom:8px}.gs-sub{font-size:13px;color:var(--tx3);margin-bottom:22px;line-height:1.65}.gs-hi{font-size:13px;font-weight:700;color:var(--amber);margin-bottom:22px}.gs-level{font-size:11px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:20px}.gs-num{font-family:var(--fM);font-size:62px;font-weight:300;letter-spacing:-3px;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite,flashNum .4s var(--spring);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:12px}.gs-hint{font-size:12px;color:var(--tx3)}.g-in{width:100%;background:var(--bg3);border:2px solid var(--b2);border-radius:var(--r-lg);padding:16px;font-family:var(--fM);font-size:32px;color:var(--tx);text-align:center;outline:none;letter-spacing:4px;margin-bottom:16px;transition:border-color .2s}.g-in:focus{border-color:var(--v2)}.g-in.err{border-color:var(--red);animation:shake .3s ease}.go-emoji{font-size:52px;display:block;margin-bottom:14px;animation:popIn .5s var(--spring)}.go-title{font-family:var(--fD);font-size:24px;font-weight:900;margin-bottom:8px}.go-sub{font-size:13px;color:var(--tx2);margin-bottom:16px;line-height:1.6}.go-stats{display:flex;gap:12px;justify-content:center;margin-bottom:22px}.go-sc{background:var(--card2);border:1px solid var(--b2);border-radius:var(--r-xl);padding:14px 18px}.go-sn{font-family:var(--fD);font-size:26px;font-weight:900}.go-stats .go-sc:nth-child(1) .go-sn{color:var(--violet)}.go-stats .go-sc:nth-child(2) .go-sn{color:var(--amber)}.go-sl{font-size:10px;color:var(--tx3);font-weight:600;text-transform:uppercase;margin-top:2px}.cm-timer{font-family:var(--fM);font-size:36px;font-weight:300;color:var(--tx);margin-bottom:4px}.cm-timer-lbl{font-size:10px;font-weight:700;color:var(--tx3);text-transform:uppercase;margin-bottom:20px}.cm-word{font-family:var(--fD);font-size:52px;font-weight:900;letter-spacing:-1px;margin-bottom:8px;animation:colorFlash .3s var(--spring)}.cm-question{font-size:12px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:24px}.cm-btns{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:18px}.cm-yes{background:rgba(16,185,129,0.15);border:2px solid rgba(16,185,129,0.35);border-radius:var(--r-xl);padding:18px;font-family:var(--fD);font-size:20px;font-weight:900;color:var(--green);cursor:pointer;transition:all .15s}.cm-no{background:rgba(248,113,113,0.12);border:2px solid rgba(248,113,113,0.3);border-radius:var(--r-xl);padding:18px;font-family:var(--fD);font-size:20px;font-weight:900;color:var(--red);cursor:pointer;transition:all .15s}.cm-yes:active{transform:scale(0.9)}.cm-no:active{transform:scale(0.9)}.cm-score-row{display:flex;justify-content:center;gap:20px;margin-bottom:6px}.cm-sc-item{text-align:center}.cm-sc-num{font-family:var(--fD);font-size:20px;font-weight:900}.cm-sc-item:nth-child(1) .cm-sc-num{color:var(--green)}.cm-sc-item:nth-child(2) .cm-sc-num{color:var(--red)}.cm-sc-lbl{font-size:9px;color:var(--tx3);font-weight:700;text-transform:uppercase}.cm-feedback{height:28px;display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:4px}.mb-opt{background:var(--card2);border:1.5px solid var(--b2);border-radius:var(--r-lg);padding:14px 8px;font-family:var(--fD);font-size:22px;font-weight:700;color:var(--tx);cursor:pointer;transition:all .15s var(--spring);width:100%}.mb-opt:active{transform:scale(0.9)}.g-btn{width:100%;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border:none;border-radius:var(--r-lg);padding:14px;font-family:var(--fB);font-size:15px;font-weight:700;color:#fff;cursor:pointer;box-shadow:0 8px 24px rgba(139,92,246,0.35)}.g-btn:active{opacity:.85}.g-btn2{width:100%;background:var(--card2);border:1.5px solid var(--b2);border-radius:var(--r-lg);padding:12px;font-family:var(--fB);font-size:14px;font-weight:700;color:var(--tx3);cursor:pointer;margin-top:10px}.settings-card{margin:14px 18px 0;background:var(--card);border:1px solid var(--b1);border-radius:var(--r-xl);padding:18px}.settings-title{font-size:14px;font-weight:700;color:var(--tx);margin-bottom:14px}.setting-row{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--b1);gap:12px}.setting-row:last-child{border-bottom:none;padding-bottom:0}.s-name{font-size:13px;font-weight:600;color:var(--tx)}.s-desc{font-size:11px;color:var(--tx3);margin-top:2px;line-height:1.5}.share-section{margin:14px 18px 0;background:var(--card);border:1px solid var(--b1);border-radius:var(--r-xl);padding:18px;position:relative;overflow:hidden}.share-section::before{content:'';position:absolute;top:0;left:0;right:0;height:1.5px;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite}.share-title{font-size:14px;font-weight:700;color:var(--tx);margin-bottom:4px}.share-sub{font-size:12px;color:var(--tx3);margin-bottom:14px;line-height:1.6}.ref-row{background:var(--bg3);border:1.5px solid var(--b2);border-radius:var(--r-md);padding:11px 13px;display:flex;align-items:center;gap:9px;margin-bottom:12px}.ref-url{flex:1;font-family:var(--fM);font-size:11px;color:var(--teal);word-break:break-all}.ref-copy{background:var(--v2);border:none;border-radius:var(--r-sm);padding:8px 14px;font-family:var(--fB);font-size:12px;font-weight:700;color:#fff;cursor:pointer;white-space:nowrap;flex-shrink:0}.share-btns{display:flex;gap:7px}.sh-btn{flex:1;border:none;border-radius:var(--r-md);padding:11px 6px;font-family:var(--fB);font-size:12px;font-weight:700;cursor:pointer}.sh-wa{background:rgba(37,211,102,0.1);color:#25d366;border:1.5px solid rgba(37,211,102,0.25)}.sh-tw{background:rgba(29,161,242,0.1);color:#1da1f2;border:1.5px solid rgba(29,161,242,0.25)}.sh-more{background:var(--card2);color:var(--tx3);border:1.5px solid var(--b2)}.support-wrap{margin:14px 18px 0}.support-btn{display:flex;align-items:center;gap:12px;width:100%;background:linear-gradient(135deg,rgba(245,158,11,0.15),rgba(251,146,60,0.1));border:1.5px solid rgba(245,158,11,0.35);border-radius:var(--r-xl);padding:16px 20px;text-decoration:none;animation:supportGlow 3s ease-in-out infinite;cursor:pointer}.support-ico{font-size:22px;flex-shrink:0}.support-main{font-size:13px;font-weight:700;color:var(--amber)}.support-sub{font-size:10px;color:var(--tx3);margin-top:1px}.contact-wrap{margin:14px 18px 0}.contact-btn{display:flex;align-items:center;gap:12px;width:100%;background:var(--card);border:1.5px solid var(--b2);border-radius:var(--r-xl);padding:16px 18px;text-decoration:none;cursor:pointer;transition:all .2s}.contact-ico{font-size:22px;flex-shrink:0}.contact-main{font-size:13px;font-weight:700;color:var(--tx)}.contact-sub{font-size:11px;color:var(--tx3);margin-top:2px}.contact-arr{font-size:20px;color:var(--tx3);margin-left:auto;flex-shrink:0}#completeOverlay{position:fixed;inset:0;z-index:200;background:rgba(7,7,15,0.88);backdrop-filter:blur(20px);display:flex;align-items:center;justify-content:center;padding:26px;opacity:0;pointer-events:none;transition:opacity .35s}#completeOverlay.show{opacity:1;pointer-events:all}.co-card{background:var(--card);border:1px solid var(--b2);border-radius:28px;padding:32px 26px;text-align:center;max-width:360px;width:100%;animation:scaleIn .35s var(--spring);position:relative;overflow:hidden;box-shadow:0 40px 100px var(--sha)}.co-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite}.co-emoji{font-size:50px;display:block;margin-bottom:14px;animation:popIn .5s var(--spring)}.co-title{font-family:var(--fD);font-size:24px;font-weight:900;margin-bottom:7px}.co-msg{font-size:13px;color:var(--tx2);margin-bottom:11px;line-height:1.7}.co-motive{font-size:13px;font-weight:600;background:rgba(45,212,191,0.1);border:1px solid rgba(45,212,191,0.25);border-radius:var(--r-md);padding:11px 14px;color:var(--teal);margin-bottom:18px;line-height:1.5}.co-btn{width:100%;border:none;border-radius:14px;padding:13px;font-family:var(--fD);font-size:14px;font-weight:900;cursor:pointer;transition:opacity .15s}.co-done{background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;color:#fff;margin-bottom:9px}.co-keep{background:var(--card2);color:var(--tx3);border:1.5px solid var(--b2)}.legal-modal{position:fixed;inset:0;z-index:350;display:flex;align-items:flex-end;justify-content:center}.legal-bg{position:absolute;inset:0;background:rgba(7,7,15,0.85);backdrop-filter:blur(12px)}.legal-sheet{position:relative;z-index:1;background:var(--card);border-radius:28px 28px 0 0;padding:24px 22px 48px;width:100%;max-width:440px;animation:slideUp .35s var(--spring);max-height:85vh;overflow-y:auto}.legal-handle{width:40px;height:4px;border-radius:99px;background:var(--b3);margin:0 auto 20px}.legal-close{position:absolute;top:14px;right:16px;width:30px;height:30px;border-radius:50%;background:var(--card2);border:1px solid var(--b2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:13px;color:var(--tx3)}.legal-title{font-family:var(--fD);font-size:20px;font-weight:900;margin-bottom:16px}.legal-body{font-size:13px;color:var(--tx2);line-height:1.8}.legal-body h3{font-size:13px;font-weight:700;color:var(--tx);margin:16px 0 6px}.legal-body p{margin-bottom:10px}#toast{position:fixed;top:68px;left:50%;transform:translateX(-50%) translateY(-12px);background:var(--card2);border:1px solid var(--b2);border-radius:var(--r-pill);padding:9px 20px;font-size:13px;font-weight:600;color:var(--tx);z-index:999;opacity:0;pointer-events:none;transition:all .3s var(--spring);white-space:nowrap;box-shadow:0 8px 36px var(--sha)}#toast.show{opacity:1;transform:translateX(-50%) translateY(0)}.app-footer{text-align:center;padding:18px 0 4px}.back-btn{background:transparent;border:1.5px solid var(--b2);border-radius:var(--r-pill);padding:7px 16px;font-family:var(--fB);font-size:11px;font-weight:700;color:var(--tx3);cursor:pointer;margin-bottom:8px}.foot-txt{font-size:11px;color:var(--tx3)}.foot-links{display:flex;gap:16px;justify-content:center;margin-top:8px}.foot-link{font-size:11px;color:var(--tx3);cursor:pointer;text-decoration:underline;text-underline-offset:3px}.bottom-nav{position:fixed;bottom:0;left:0;right:0;z-index:90;display:flex;align-items:stretch;background:var(--card);border-top:1px solid var(--b2);height:60px;padding-bottom:env(safe-area-inset-bottom,0px)}[data-theme="light"] .bottom-nav{background:#fff}.bnav-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;cursor:pointer;padding:8px 4px;border:none;background:none;position:relative}.bnav-ico{font-size:21px;line-height:1;transition:transform .2s var(--spring)}.bnav-lbl{font-size:9px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:0.06em;transition:color .18s}.bnav-item.t-active .bnav-lbl{color:var(--violet)}.bnav-item.t-active .bnav-ico{transform:translateY(-2px) scale(1.2)}.bnav-item:active .bnav-ico{transform:scale(0.85)}.bnav-item.t-active::before{content:'';position:absolute;top:0;left:25%;right:25%;height:2px;background:var(--violet);border-radius:99px}.tab-pane{display:none;padding-bottom:80px}.tab-pane.t-active{display:block}#shareCardModal{position:fixed;inset:0;z-index:400;display:flex;align-items:center;justify-content:center;padding:20px;background:rgba(7,7,15,0.92);backdrop-filter:blur(20px)}.sc-wrap{background:var(--card);border:1px solid var(--b2);border-radius:28px;padding:24px;max-width:360px;width:100%;animation:scaleIn .35s var(--spring);box-shadow:0 40px 100px var(--sha)}.sc-canvas-wrap{border-radius:20px;overflow:hidden;margin-bottom:18px;box-shadow:0 12px 40px rgba(139,92,246,0.3)}#shareCanvas{display:block;width:100%;border-radius:20px}.sc-btns{display:flex;gap:10px;margin-bottom:10px}.sc-dl{flex:1;background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border:none;border-radius:var(--r-lg);padding:13px;font-family:var(--fB);font-size:14px;font-weight:700;color:#fff;cursor:pointer}.sc-close{width:100%;margin-top:8px;background:transparent;border:1.5px solid var(--b1);border-radius:var(--r-lg);padding:11px;font-family:var(--fB);font-size:13px;font-weight:600;color:var(--tx3);cursor:pointer}.guide-btn{display:flex;align-items:center;gap:7px;margin:12px 18px 0;background:rgba(139,92,246,0.08);border:1px solid rgba(139,92,246,0.2);border-radius:var(--r-pill);padding:8px 16px;font-family:var(--fB);font-size:12px;font-weight:600;color:var(--violet);cursor:pointer}.focus-support{margin:14px 18px 8px}</style>

<link rel="manifest" id="pwaManifest">
<script>
// Build manifest dynamically and set it as a blob URL
// (data: URI manifests are rejected by Chrome for PWA install)
(function(){
  const manifest = {
    name: 'Focuz -- Deep Work Timer',
    short_name: 'Focuz',
    description: 'Beautiful Pomodoro timer with ambient sounds, brain games and session tracking.',
    start_url: './',
    display: 'standalone',
    background_color: '#07070f',
    theme_color: '#8b5cf6',
    orientation: 'portrait',
    icons: [
      {src:'https://api.iconify.design/emojione:direct-hit.svg?color=%238b5cf6', sizes:'192x192', type:'image/svg+xml', purpose:'any maskable'},
      {src:'https://api.iconify.design/emojione:direct-hit.svg?color=%238b5cf6', sizes:'512x512', type:'image/svg+xml', purpose:'any maskable'}
    ]
  };
  const blob = new Blob([JSON.stringify(manifest)], {type:'application/manifest+json'});
  document.getElementById('pwaManifest').href = URL.createObjectURL(blob);
})();
</script>
<script>if('serviceWorker' in navigator){const c='self.addEventListener(\'install\',e=>self.skipWaiting());self.addEventListener(\'fetch\',e=>e.respondWith(fetch(e.request).catch(()=>caches.match(e.request))));';const b=new Blob([c],{type:'application/javascript'});navigator.serviceWorker.register(URL.createObjectURL(b)).catch(()=>{});}</script>
</head>
<body>

<div id="atmos"><div class="orb orb1"></div><div class="orb orb2"></div><div class="orb orb3"></div></div>
<div id="toast"></div>

<!-- ONBOARDING -->
<div id="onboarding" class="ob-wrap hidden">
  <div class="ob-card">
    <div id="ob-slides"></div>
    <div class="ob-dots" id="obDots"></div>
  </div>
</div>

<!-- AUTH MODAL -->
<div id="authModal" class="auth-wrap hidden">
  <div class="auth-bg" id="authBg"></div>
  <div class="auth-card">
    <div class="auth-logo">focuz</div>
    <div class="auth-tag">Sign in to save your progress across devices.</div>
    <div class="auth-tabs">
      <button class="auth-tab on" id="tabIn">Sign In</button>
      <button class="auth-tab" id="tabUp">Create Account</button>
    </div>
    <div id="authMsg" class="auth-msg hidden"></div>
    <input class="auth-in" id="authEmail" type="email" placeholder="Email address" autocomplete="email">
    <input class="auth-in" id="authPass" type="password" placeholder="Password (min 6 chars)" autocomplete="current-password">
    <div id="authTCRow" style="display:none;margin-bottom:12px">
      <label style="display:flex;align-items:flex-start;gap:10px;cursor:pointer;font-size:12px;color:var(--tx3);line-height:1.5;padding:10px 12px;background:var(--card);border-radius:10px">
        <input type="checkbox" id="authTC" style="margin-top:2px;accent-color:var(--violet);width:15px;height:15px;flex-shrink:0">
        <span>I agree to the <button type="button" id="tcTermsBtn" style="background:none;border:none;color:var(--violet);font-size:12px;cursor:pointer;padding:0;font-family:inherit">Terms of Use</button> and <button type="button" id="tcPrivBtn" style="background:none;border:none;color:var(--violet);font-size:12px;cursor:pointer;padding:0;font-family:inherit">Privacy Policy</button></span>
      </label>
    </div>
    <button class="auth-submit" id="authSubmit">Sign In</button>
    <div class="auth-divider"><span>or</span></div>
    <div class="guest-warn">
      <span class="gw-ico">&#x26A0;&#xFE0F;</span>
      <div class="gw-txt"><strong>Guest mode</strong> Progress lost when you close the app. Sign up free to keep everything.</div>
    </div>
    <button class="auth-guest" id="guestBtn">Continue as Guest (data won't be saved)</button>
  </div>
</div>

<!-- COMPLETE OVERLAY -->
<div id="completeOverlay">
  <div class="co-card">
    <span class="co-emoji" id="coEmoji">&#x1F389;</span>
    <div class="co-title">Session Done!</div>
    <div class="co-msg" id="coMsg"></div>
    <div class="co-motive" id="coMotive"></div>
    <button class="co-btn co-done" id="coDone">&#x2705; Mark task done</button>
    <button class="co-btn co-keep" id="coClose">&#x1F501; Keep going</button>
  </div>
</div>

<!-- SESSION SHARE CARD -->
<div id="shareCardModal" class="hidden">
  <div class="sc-wrap">
    <div class="sc-canvas-wrap">
      <canvas id="shareCanvas" width="720" height="720"></canvas>
    </div>
    <!-- Primary: Share with image via native sheet -->
    <button class="sc-primary" id="scNative">&#x1F4E4; Share Card</button>
    <!-- Quick text links -->
    <div class="sc-btns" style="margin-top:10px">
      <button class="sc-dl" id="scDownload">&#x1F4BE; Save Image</button>
      <button class="sc-close" id="scClose">&#x2715; Close</button>
    </div>
  </div>
</div>

<!-- WEEKLY RECAP -->
<div id="weeklyModal" class="hidden">
  <div class="wm-bg" id="wmBg"></div>
  <div class="wm-sheet">
    <button class="wm-close" id="wmClose">&#x2715;</button>
    <div class="wm-handle"></div>
    <div class="wm-title">&#x1F4C5; Weekly Recap</div>
    <div class="wm-range" id="wmRange">This week</div>
    <div class="recap-grid">
      <div class="rg-card"><div class="rg-num" id="rg1">0</div><div class="rg-lbl">Sessions</div></div>
      <div class="rg-card"><div class="rg-num" id="rg2">0</div><div class="rg-lbl">Minutes</div></div>
      <div class="rg-card"><div class="rg-num" id="rg3">0</div><div class="rg-lbl">Day streak</div></div>
      <div class="rg-card"><div class="rg-num" id="rg4">&#x2014;</div><div class="rg-lbl">Best day</div></div>
    </div>
    <div class="recap-bars"><div class="rb-lbl">Sessions per day</div><div id="recapBars"></div></div>
    <button class="recap-share-btn" id="recapShare">&#x1F4E4; Share my weekly recap</button>
  </div>
</div>

<!-- NUMBER MEMORY GAME -->
<div id="memModal" class="game-modal-wrap hidden">
  <div class="gm-card">
    <button class="gm-x" id="memClose">&#x2715;</button>
    <div id="msc-start">
      <div style="font-size:40px;margin-bottom:12px">&#x1F9E0;</div>
      <div class="gs-title">Number Memory</div>
      <div class="gs-sub">A number flashes briefly. Memorise it, then type it back. Each correct answer adds a digit!</div>
      <div class="gs-hi" id="memHiText">Best: &#x2014; digits</div>
      <button class="g-btn" id="memStart">Start Game</button>
    </div>
    <div id="msc-show" style="display:none">
      <div class="gs-level" id="memLevel">Level 1 &middot; 3 digits</div>
      <div class="gs-num" id="memNum">123</div>
      <div class="gs-hint">Memorise it...</div>
    </div>
    <div id="msc-input" style="display:none">
      <div class="gs-level" id="memLevel2">What was the number?</div>
      <input class="g-in" id="memIn" type="number" inputmode="numeric" pattern="[0-9]*" placeholder="...">
      <button class="g-btn" id="memSubmit">Submit</button>
    </div>
    <div id="msc-over" style="display:none">
      <span class="go-emoji" id="memEmoji">&#x1F605;</span>
      <div class="go-title" id="memOverTitle">Good try!</div>
      <div class="go-sub" id="memOverSub"></div>
      <div class="go-stats">
        <div class="go-sc"><div class="go-sn" id="memReached">3</div><div class="go-sl">Digits reached</div></div>
        <div class="go-sc"><div class="go-sn" id="memHiNum">0</div><div class="go-sl">Personal best</div></div>
      </div>
      <button class="g-btn" id="memReplay">Play Again</button>
      <button class="g-btn2" id="memDone">Done</button>
    </div>
  </div>
</div>

<!-- COLOUR MATCH GAME -->
<div id="cmModal" class="game-modal-wrap hidden">
  <div class="gm-card">
    <button class="gm-x" id="cmClose">&#x2715;</button>
    <div id="cmc-start">
      <div style="font-size:40px;margin-bottom:12px">&#x1F3A8;</div>
      <div class="gs-title">Colour Match</div>
      <div class="gs-sub">A colour word appears in coloured ink. Tap MATCH if word and colour agree, DIFFERENT if not. 3 lives &#x2764;&#xFE0F;</div>
      <div class="gs-hi" id="cmHiText">Best: &#x2014;</div>
      <button class="g-btn" id="cmStart">Start Game</button>
    </div>
    <div id="cmc-play" style="display:none">
      <div class="cm-timer" id="cmStreakDisp">&#x1F525; 0</div>
      <div class="cm-timer-lbl" id="cmLivesDisp">&#x2764;&#xFE0F;&#x2764;&#xFE0F;&#x2764;&#xFE0F;</div>
      <div class="cm-word" id="cmWord" style="color:red">RED</div>
      <div class="cm-question">Does the word match its colour?</div>
      <div class="cm-feedback" id="cmFeedback"></div>
      <div class="cm-btns">
        <button class="cm-yes" id="cmYes">&#x2713; MATCH</button>
        <button class="cm-no" id="cmNo">&#x2717; DIFFERENT</button>
      </div>
      <div class="cm-score-row">
        <div class="cm-sc-item"><div class="cm-sc-num" id="cmRight">0</div><div class="cm-sc-lbl">Correct</div></div>
        <div class="cm-sc-item"><div class="cm-sc-num" id="cmWrong">0</div><div class="cm-sc-lbl">Wrong</div></div>
      </div>
    </div>
    <div id="cmc-over" style="display:none">
      <span class="go-emoji" id="cmEmoji">&#x1F3A8;</span>
      <div class="go-title" id="cmOverTitle">Game Over!</div>
      <div class="go-sub" id="cmOverSub"></div>
      <div class="go-stats">
        <div class="go-sc"><div class="go-sn" id="cmFinalRight">0</div><div class="go-sl">Correct</div></div>
        <div class="go-sc"><div class="go-sn" id="cmFinalHi">0</div><div class="go-sl">Best score</div></div>
      </div>
      <button class="g-btn" id="cmReplay">Play Again</button>
      <button class="g-btn2" id="cmDone">Done</button>
    </div>
  </div>
</div>

<!-- MATH BLITZ GAME -->
<div id="mbModal" class="game-modal-wrap hidden">
  <div class="gm-card">
    <button class="gm-x" id="mbClose">&#x2715;</button>
    <div id="mbc-start">
      <div style="font-size:40px;margin-bottom:12px">&#x1F9EE;</div>
      <div class="gs-title">Math Blitz</div>
      <div class="gs-sub">Solve quick sums before the timer runs out. 3 lives &#x2764;&#xFE0F; &#x2014; gets faster every 10 correct!</div>
      <div class="gs-hi" id="mbHiText">Best: &#x2014;</div>
      <button class="g-btn" id="mbStart">Start Game</button>
    </div>
    <div id="mbc-play" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-size:22px;font-weight:900;color:var(--violet);font-family:var(--fD)" id="mbScore">0</div>
        <div id="mbLives" style="font-size:16px">&#x2764;&#xFE0F;&#x2764;&#xFE0F;&#x2764;&#xFE0F;</div>
        <div id="mbStreak" style="font-size:13px;font-weight:700;color:var(--amber)">&#x1F525; 0</div>
      </div>
      <div style="height:6px;background:var(--card3);border-radius:99px;overflow:hidden;margin-bottom:16px">
        <div id="mbBar" style="height:100%;width:100%;background:linear-gradient(90deg,var(--green),var(--teal));border-radius:99px;transition:width linear"></div>
      </div>
      <div class="cm-word" id="mbQuestion" style="font-size:1.5em;letter-spacing:0">3 + 4 = ?</div>
      <div class="cm-feedback" id="mbFeedback"></div>
      <div id="mbGrid" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:14px"></div>
    </div>
    <div id="mbc-over" style="display:none">
      <span class="go-emoji" id="mbEmoji">&#x1F9EE;</span>
      <div class="go-title" id="mbOverTitle">Nice work!</div>
      <div class="go-sub" id="mbOverSub"></div>
      <div class="go-stats">
        <div class="go-sc"><div class="go-sn" id="mbFinalScore">0</div><div class="go-sl">Correct</div></div>
        <div class="go-sc"><div class="go-sn" id="mbFinalHi">0</div><div class="go-sl">Best score</div></div>
      </div>
      <button class="g-btn" id="mbReplay">Play Again</button>
      <button class="g-btn2" id="mbDone">Done</button>
    </div>
  </div>
</div>

<!-- LEGAL MODAL -->
<div id="legalModal" class="legal-modal hidden">
  <div class="legal-bg" id="legalBg"></div>
  <div class="legal-sheet">
    <button class="legal-close" id="legalClose">&#x2715;</button>
    <div class="legal-handle"></div>
    <div class="legal-title" id="legalTitle">Privacy Policy</div>
    <div class="legal-body" id="legalBody"></div>
  </div>
</div>

<!-- LANDING PAGE -->
<div id="landing" class="page active">
  <nav class="land-nav">
    <div class="land-logo">focuz</div>
    <div class="nav-r">
      <div class="theme-btn" id="landTheme"><div class="theme-knob"><span class="t-d">&#x1F319;</span><span class="t-l">&#x2600;&#xFE0F;</span></div></div>
      <button class="nav-cta" id="navCta">Get Started &#x2192;</button>
    </div>
  </nav>
  <div class="land-hero">
    <div class="eyebrow"><div class="edot"></div>Deep Work Timer</div>
    <h1 class="hero-h1"><span>Your focus,</span><br><span class="grad-text">levelled up.</span></h1>
    <p class="hero-sub">Beautiful Pomodoro timer with Brown Noise, smart beat suggestions, brain games and full session history. Build your focus habit &#x2014; one session at a time.</p>
    <button class="btn-hero" id="heroCta">&#x1F680; Start Focusing Free</button>
    <div class="feat-grid">
      <div class="feat-tile"><div class="fi">&#x23F1;</div><div class="fn">Pomodoro Timer</div><div class="fd">Animated ring timer with gradient glow</div></div>
      <div class="feat-tile"><div class="fi">&#x1F3A7;</div><div class="fn">Brown Noise</div><div class="fd">The universal deep work beat plus lo-fi, rain and fire</div></div>
      <div class="feat-tile"><div class="fi">&#x1F4A1;</div><div class="fn">Smart Suggestions</div><div class="fd">App picks the best beat for your task</div></div>
      <div class="feat-tile"><div class="fi">&#x1F9E0;</div><div class="fn">Brain Games</div><div class="fd">Number Memory, Colour Match, Math Blitz</div></div>
      <div class="feat-tile"><div class="fi">&#x1F4C5;</div><div class="fn">Session Calendar</div><div class="fd">Track every session and view history</div></div>
      <div class="feat-tile"><div class="fi">&#x1F3C6;</div><div class="fn">Badges &amp; Streaks</div><div class="fd">Earn achievements as you build the habit</div></div>
    </div>
    <div class="land-cta-box">
      <div class="cta-h">Ready to lock in?</div>
      <div class="cta-s">Free forever. No credit card. Works offline.</div>
      <button class="btn-hero" id="heroCta2" style="margin:0 auto;display:block;max-width:280px;width:100%">Start Focusing &#x2192;</button>
    </div>
    <div class="land-links">
      <span class="land-link" id="landPrivacy">Privacy Policy</span>
      <span class="land-link" id="landTerms">Terms of Use</span>
    </div>
    <div class="land-foot">Made with &#x1F49C; &middot; Focuz v5.0</div>
  </div>
</div>

<!-- APP PAGE -->
<div id="app" class="page">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="app-logo" id="appLogo">focuz</div>
    <div class="topbar-r">
      <div class="streak-badge">&#x1F525; <span id="streakN">0</span></div>
      <div class="sdot off" id="syncDot"></div>
      <div class="theme-btn" id="appTheme"><div class="theme-knob"><span class="t-d">&#x1F319;</span><span class="t-l">&#x2600;&#xFE0F;</span></div></div>
      <div id="userWrap"><button class="signin-btn" id="topSignIn">Sign in</button></div>
    </div>
  </div>
  <div class="user-menu hidden" id="userMenu">
    <div class="um-item" id="umSignOut">&#x1F44B; Sign out</div>
  </div>

  <!-- FOCUS TAB -->
  <div class="tab-pane t-active" id="tab-focus">
    <button class="guide-btn" id="guideBtn"><span style="font-size:14px">&#x1F4D6;</span> How to use Focuz</button>
    <div class="quote-strip">
      <div class="qs-mark">"</div>
      <div><div class="qs-text" id="qText">The secret of getting ahead is getting started.</div><div class="qs-auth" id="qAuth">&#x2014; Mark Twain</div></div>
    </div>
    <div class="guest-banner hidden" id="guestBanner">
      <div class="gb-txt"><strong>&#x26A0;&#xFE0F; Guest mode &#x2014; no data saved</strong>Sign up free to keep your history and streaks.</div>
      <button class="gb-btn" id="gbSignUp">Sign up</button>
    </div>
    <div class="streak-hero reveal">
      <div class="streak-l">
        <div style="font-size:28px">&#x1F525;</div>
        <div><div class="streak-count"><span id="streakBig">0</span> days</div><div class="streak-lbl">Current streak</div></div>
      </div>
      <div class="week-dots" id="weekDots"></div>
    </div>
    <div class="intention-card">
      <div class="int-lbl">&#x1F9E0; What are you focusing on?<span class="int-cnt hidden" id="intCnt">0/80</span></div>
      <input class="int-in" id="intentionIn" type="text" placeholder="e.g. Study, write report, coding..." maxlength="80">
      <button class="sound-suggest hidden" id="soundSuggest"></button>
    </div>
    <div class="task-panel reveal">
      <div class="task-panel-head" id="taskPanelHead">
        <div class="sec-lbl" style="margin:0">&#x1F4CB; Tasks</div>
        <div class="task-head-r">
          <span class="task-cnt" id="taskCnt">0</span>
          <div class="task-panel-arr" id="taskToggle">&#x25BC;</div>
        </div>
      </div>
      <div class="task-body" id="taskBody">
        <div class="task-add-row">
          <input class="task-in" id="taskIn" type="text" placeholder="Add a task..." maxlength="80">
          <button class="task-add-btn" id="taskAddBtn">+</button>
        </div>
        <div class="task-prio-row" id="prioPicker">
          <button class="prio-chip on" data-p="mid">&#x1F7E0; Mid</button>
          <button class="prio-chip" data-p="high">&#x1F534; High</button>
          <button class="prio-chip" data-p="low">&#x1F7E2; Low</button>
        </div>
        <div class="task-list" id="taskList">
          <div class="task-empty" id="taskEmpty">No tasks yet &#x2014; add one above &#x1F446;</div>
        </div>
      </div>
    </div>
    <div class="presets-card">
      <div class="sec-lbl">&#x23F1; How long?</div>
      <div class="presets-grid" id="presetsGrid">
        <div class="preset on" data-min="25"><div class="preset-min">25</div><div class="preset-sub">minutes</div></div>
        <div class="preset" data-min="45"><div class="preset-min">45</div><div class="preset-sub">minutes</div></div>
        <div class="preset" data-min="60"><div class="preset-min">60</div><div class="preset-sub">minutes</div></div>
        <div class="preset" data-min="90"><div class="preset-min">90</div><div class="preset-sub">minutes</div></div>
      </div>
      <div class="custom-row" id="customRow">
        <span class="cr-lbl">Custom:</span>
        <input class="cr-in" id="customMin" type="number" min="1" max="180" placeholder="e.g. 35">
        <span class="cr-unit">min</span>
      </div>
    </div>
    <div class="sound-card">
      <div class="sec-lbl">&#x1F3B5; Focus beat</div>
      <div class="sound-grid" id="soundGrid">
        <div class="sound-btn on" data-sound="brown"><span class="s-ico">&#x1F3A7;</span><span class="s-name">Focus</span></div>
        <div class="sound-btn" data-sound="ocean"><span class="s-ico">&#x1F30A;</span><span class="s-name">Ocean</span></div>
        <div class="sound-btn" data-sound="rain"><span class="s-ico">&#x1F327;&#xFE0F;</span><span class="s-name">Rain</span></div>
        <div class="sound-btn" data-sound="bass"><span class="s-ico">&#x1F3B5;</span><span class="s-name">Bowl</span></div>
        <div class="sound-btn" data-sound="none"><span class="s-ico">&#x1F507;</span><span class="s-name">Off</span></div>
      </div>
    </div>
    <div class="timer-card" id="timerCard">
      <div class="focus-pill fp-e" id="focusPill">&#x1F446; Type your intention above</div>
      <div class="ring-wrap">
        <svg class="ring-svg" width="200" height="200" viewBox="0 0 200 200">
          <defs><linearGradient id="rGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#f472b6"/><stop offset="50%" style="stop-color:#8b5cf6"/><stop offset="100%" style="stop-color:#2dd4bf"/></linearGradient></defs>
          <circle class="r-track" cx="100" cy="100" r="86"/>
          <circle class="r-glow" id="rGlow" cx="100" cy="100" r="86" stroke-dasharray="540" stroke-dashoffset="0"/>
          <circle class="r-prog" id="rProg" cx="100" cy="100" r="86" stroke-dasharray="540" stroke-dashoffset="0"/>
        </svg>
        <div class="ring-center">
          <div class="ring-digits" id="rDig">25:00</div>
          <div class="ring-status" id="rStat">tap play to start</div>
        </div>
      </div>
      <div class="viz" id="viz"></div>
      <div class="t-controls">
        <button class="t-btn" id="resetBtn">&#x21BA;</button>
        <button class="t-btn t-play ripple-wrap" id="playBtn">&#x25B6;</button>
        <button class="t-btn" id="skipBtn">&#x23ED;</button>
      </div>
      <div class="pomo-row">
        <div class="pomo-l">
          <span class="pomo-lbl">&#x1F345; Pomodoro mode</span>
          <div class="pomo-cycles hidden" id="pomoCycles">
            <span class="pomo-cyc" id="pc1">&#x1F345;</span><span class="pomo-cyc" id="pc2">&#x1F345;</span>
            <span class="pomo-cyc" id="pc3">&#x1F345;</span><span class="pomo-cyc" id="pc4">&#x1F345;</span>
          </div>
        </div>
        <label class="tog"><input type="checkbox" id="togPomo"><div class="tog-track"></div></label>
      </div>
    </div>
    <div id="breakOverlay" class="break-overlay hidden">
      <div class="break-card">
        <div class="break-emoji" id="breakEmoji">&#x2615;</div>
        <div class="break-title" id="breakTitle">Short Break!</div>
        <div class="break-msg" id="breakMsg">You crushed that session. Take 5 minutes.</div>
        <div class="break-ring-wrap">
          <svg width="140" height="140" viewBox="0 0 140 140" style="transform:rotate(-90deg)">
            <circle fill="none" stroke="rgba(16,185,129,0.15)" stroke-width="7" cx="70" cy="70" r="58"/>
            <circle id="bkProg" fill="none" stroke="#10b981" stroke-width="7" stroke-linecap="round" cx="70" cy="70" r="58" stroke-dasharray="364" stroke-dashoffset="0"/>
          </svg>
          <div class="break-digits" id="breakDig">05:00</div>
        </div>
        <div class="break-btns">
          <button class="brk-skip" id="brkSkip">Skip Break &#x2192;</button>
          <button class="brk-pause" id="brkPause">&#x23F8; Pause</button>
        </div>
      </div>
    </div>
    <div class="focus-support">
      <a class="support-btn" href="https://flutterwave.com/donate/xbedglgbxop9" target="_blank" rel="noopener noreferrer">
        <span class="support-ico">&#x2615;</span>
        <div><div class="support-main">Support Focuz &#x2615;</div><div class="support-sub">Help keep the app free and growing</div></div>
      </a>
    </div>
  </div><!-- /tab-focus -->

  <!-- STATS TAB -->
  <div class="tab-pane" id="tab-stats">
    <div class="stats-3 reveal">
      <div class="stat-card"><div class="stat-num" id="stSess">0</div><div class="stat-lbl">Sessions</div></div>
      <div class="stat-card"><div class="stat-num" id="stMins">0</div><div class="stat-lbl">Minutes</div></div>
      <div class="stat-card"><div class="stat-num" id="stToday">0</div><div class="stat-lbl">Today</div></div>
    </div>
    <div class="chart-card reveal">
      <div class="chart-head">
        <div class="chart-title">&#x1F4C8; Last 7 days</div>
        <div class="chart-week-total" id="chartWeekTotal">0 sessions this week</div>
      </div>
      <div class="chart-bars" id="chartBars"></div>
      <div class="chart-days" id="chartDays"></div>
      <div class="chart-foot">
        <span class="chart-foot-item"><span class="cf-dot" style="background:var(--violet)"></span>Sessions</span>
        <span class="chart-foot-item" id="chartWeekMins">0 min total</span>
      </div>
    </div>
    <div class="history-card reveal">
      <div class="hist-head" id="histHead"><div class="hist-head-t">&#x1F4C5; Session History</div><div class="hist-arr" id="histArr">&#x25BC;</div></div>
      <div class="hist-body" id="histBody">
        <div class="cal-nav">
          <div class="cal-arr" id="calPrev">&#x25C4;</div>
          <div class="cal-month" id="calMonth"></div>
          <div class="cal-arr" id="calNext">&#x25BA;</div>
        </div>
        <div class="cal-grid" id="calGrid"></div>
        <div class="cal-detail" id="calDetail"></div>
      </div>
    </div>
    <div class="weekly-cta reveal" id="weeklyBtn">
      <div class="wc-l"><div class="wc-ico">&#x1F4CA;</div><div><div class="wc-t">Weekly Recap</div><div class="wc-s">See your focus summary and share it</div></div></div>
      <div class="wc-arr">&#x203A;</div>
    </div>
    <div class="badges-wrap reveal">
      <div class="badges-title">&#x1F3C6; Badges</div>
      <div class="badges-grid" id="badgesGrid"></div>
    </div>
  </div><!-- /tab-stats -->

  <!-- GAMES TAB -->
  <div class="tab-pane" id="tab-games">
    <div style="margin:14px 18px 0" class="reveal">
      <div class="sec-lbl">&#x1F3AE; Brain games</div>
      <div class="game-launcher">
        <div class="game-tile" id="openMem"><span class="gt-ico">&#x1F9E0;</span><div class="gt-name">Number Memory</div><div class="gt-sub">Flash recall &#x2014; beat your score</div><div class="gt-hi" id="memHiCard">Best: &#x2014;</div></div>
        <div class="game-tile" id="openCM"><span class="gt-ico">&#x1F3A8;</span><div class="gt-name">Colour Match</div><div class="gt-sub">3 lives &#x2014; play as long as you can</div><div class="gt-hi" id="cmHiCard">Best: &#x2014;</div></div>
        <div class="game-tile" id="openMB"><span class="gt-ico">&#x1F9EE;</span><div class="gt-name">Math Blitz</div><div class="gt-sub">Beat the clock &#x2014; gets faster!</div><div class="gt-hi" id="mbHiCard">Best: &#x2014;</div></div>
      </div>
    </div>
  </div><!-- /tab-games -->

  <!-- SETTINGS TAB -->
  <div class="tab-pane" id="tab-settings">
    <div class="settings-card reveal">
      <div class="settings-title">&#x2699;&#xFE0F; Settings</div>
      <div class="setting-row">
        <div><div class="s-name">&#x1F319; Theme</div><div class="s-desc">Dark or light mode</div></div>
        <div class="theme-btn" id="settingsTheme"><div class="theme-knob"><span class="t-d">&#x1F319;</span><span class="t-l">&#x2600;&#xFE0F;</span></div></div>
      </div>
      <div class="setting-row">
        <div><div class="s-name">&#x1F514; Completion chime</div><div class="s-desc">Sound alert when session ends</div></div>
        <label class="tog"><input type="checkbox" id="togChime" checked><div class="tog-track"></div></label>
      </div>
      <div class="setting-row">
        <div><div class="s-name">&#x1F3B5; Focus beats</div><div class="s-desc">Ambient audio during sessions</div></div>
        <label class="tog"><input type="checkbox" id="togAmb" checked><div class="tog-track"></div></label>
      </div>

    </div>
    <div class="share-section reveal">
      <div class="share-title">&#x1F517; Share Focuz</div>
      <div class="share-sub">Invite friends and grow your focus community.</div>
      <div class="ref-row"><div class="ref-url">getfocuzapp.netlify.app</div><button class="ref-copy" id="copyRef">Copy</button></div>
      <div class="share-btns">
        <button class="sh-btn sh-wa" id="inWA">&#x1F4AC; WhatsApp</button>
        <button class="sh-btn sh-tw" id="inTW">&#x1D54F; Twitter</button>
        <button class="sh-btn sh-more" id="inMore">&#x1F4E4; More</button>
      </div>
    </div>

      </a>
    </div>
    <div class="contact-wrap reveal">
      <a class="contact-btn" href="/cdn-cgi/l/email-protection#791e1c0d1f161a0c03180909391e14181015571a1614460a0c1b131c1a0d443f161a0c035c4b493809095c4b493f1c1c1d1b181a12">
        <span class="contact-ico">&#x2709;&#xFE0F;</span>
        <div><div class="contact-main">Contact Us</div><div class="contact-sub"><span class="__cf_email__" data-cfemail="e1868495878e82949b809191a1868c80888dcf828e8c">[email&#160;protected]</span> &middot; We reply within 24h</div></div>
        <span class="contact-arr">&#x203A;</span>
      </a>
    </div>
    <div class="app-footer">
      <button class="back-btn" id="backBtn">&#x2190; Back to home</button>
      <div class="foot-txt">Made with &#x1F49C; &middot; Focuz v5.0</div>
      <div class="foot-links">
        <span class="foot-link" id="footPrivacy">Privacy Policy</span>
        <span class="foot-link" id="footTerms">Terms of Use</span>
      </div>
    </div>
  </div><!-- /tab-settings -->

</div><!-- /app -->

<nav class="bottom-nav hidden" id="bottomNav">
  <button class="bnav-item t-active" data-tab="focus"><span class="bnav-ico">&#x1F3AF;</span><span class="bnav-lbl">Focus</span></button>
  <button class="bnav-item" data-tab="stats"><span class="bnav-ico">&#x1F4CA;</span><span class="bnav-lbl">Stats</span></button>
  <button class="bnav-item" data-tab="games"><span class="bnav-ico">&#x1F3AE;</span><span class="bnav-lbl">Games</span></button>
  <button class="bnav-item" data-tab="settings"><span class="bnav-ico">&#x2699;&#xFE0F;</span><span class="bnav-lbl">Settings</span></button>
</nav>


<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
'use strict';
const SUPABASE_URL = 'https://zrajzljohyocbnvcddsx.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpyYWp6bGpvaHlvY2JudmNkZHN4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3NDA0MjIsImV4cCI6MjA4NzMxNjQyMn0.1MWCmYCKYUA6PjXIUXQyqCJe33DQJnBFVzsOZpHAdyU';
let sb = null;
try {
if (SUPABASE_URL !== 'YOUR_SUPABASE_URL') {
sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
}
} catch(e) { console.warn('Supabase not configured'); }
const LS = {
get: (k, def=null) => { try { const v=localStorage.getItem(k); return v!==null?JSON.parse(v):def; } catch{ return def; } },
set: (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch{} },
del: (k) => { try { localStorage.removeItem(k); } catch{} }
};
let state = {
user: null,          // supabase user or null
isGuest: false,
theme: LS.get('theme','dark'),
sessions: LS.get('sessions',[]),   // [{id,date,mins,task,sound}]
tasks: LS.get('tasks',[]),         // [{id,name,prio,done,focusId?}]
streak: 0,
timerMins: 25,
timerSecs: 0,
totalSecs: 25*60,
running: false,
paused: false,
tickInterval: null,
selectedSound: LS.get('selectedSound','brown'),
ambientOn: LS.get('ambientOn',true),
chimeOn: LS.get('chimeOn',true),
pomodoroOn: LS.get('pomodoroOn',false),
get pomoOn(){ return this.pomodoroOn; }, // alias
pomoCycle: 0,        // 0-3
inBreak: false,
breakSecs: 0,
breakInterval: null,
calMonth: new Date(),
calSel: null,
focusTaskId: null,
gameScores: LS.get('gameScores',{mem:0,cm:0,mb:0}),
obStep: 0,
currentTab: 'focus',
audioCtx: null,
ambientNode: null,
gainNode: null,
oscNodes: [],  // for bass oscillators
};
function applyTheme(t) {
state.theme = t;
document.documentElement.setAttribute('data-theme', t);
LS.set('theme', t);
}
function toggleTheme() { applyTheme(state.theme==='dark'?'light':'dark'); }
applyTheme(state.theme);
const QUOTES = [
{t:"The secret of getting ahead is getting started.",a:"Mark Twain"},
{t:"Deep work is the superpower of the 21st century.",a:"Cal Newport"},
{t:"Focus on being productive instead of busy.",a:"Tim Ferriss"},
{t:"It always seems impossible until it's done.",a:"Nelson Mandela"},
{t:"Do the hard jobs first. The easy jobs will take care of themselves.",a:"Dale Carnegie"},
{t:"One hour of focused work beats eight hours of distracted effort.",a:"Unknown"},
{t:"You don't have to be great to get started, but you have to get started.",a:"Les Brown"},
{t:"The ability to focus is a superpower worth cultivating.",a:"Naval Ravikant"},
{t:"What you do today can improve all your tomorrows.",a:"Ralph Marston"},
{t:"Clarity about what matters provides clarity about what does not.",a:"Cal Newport"},
];
function loadQuote() {
const q = QUOTES[Math.floor(Math.random()*QUOTES.length)];
el('qText').textContent = q.t;
el('qAuth').textContent = '-- '+q.a;
}
const el = id => document.getElementById(id);
const qs = s => document.querySelector(s);
const qsa = s => [...document.querySelectorAll(s)];
function toast(msg, dur=2400) {
const t = el('toast');
t.textContent = msg;
t.classList.add('show');
setTimeout(()=>t.classList.remove('show'), dur);
}
function ripple(btn, e) {
const r = document.createElement('div');
r.className = 'ripple-el';
const rect = btn.getBoundingClientRect();
const size = Math.max(rect.width, rect.height);
r.style.cssText = `width:${size}px;height:${size}px;left:${(e.clientX||rect.left+rect.width/2)-rect.left-size/2}px;top:${(e.clientY||rect.top+rect.height/2)-rect.top-size/2}px`;
btn.appendChild(r);
setTimeout(()=>r.remove(), 700);
}
const revealObs = new IntersectionObserver(entries=>{
entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('visible'); });
}, {threshold:0.1});
function observeReveals() { qsa('.reveal').forEach(el=>revealObs.observe(el)); }
function showApp() {
el('landing').classList.remove('active');
el('app').classList.add('active');
el('bottomNav').classList.remove('hidden');
observeReveals();
renderWeekDots();
updateStats();
updateTaskUI();
loadQuote();
updateGameHiCards();
}
function showLanding() {
el('app').classList.remove('active');
el('bottomNav').classList.add('hidden');
el('landing').classList.add('active');
}
function switchTab(name) {
state.currentTab = name;
qsa('.tab-pane').forEach(p=>p.classList.toggle('t-active', p.id==='tab-'+name));
qsa('.bnav-item').forEach(b=>b.classList.toggle('t-active', b.dataset.tab===name));
window.scrollTo({top:0,behavior:'instant'});
if(name==='stats') { renderChart(); renderWeekDots(); renderCalendar(); renderBadges(); updateStats(); }
if(name==='games') { updateGameHiCards(); }
}
let authMode = 'in';
function showAuth() { el('authModal').classList.remove('hidden'); }
function hideAuth() { el('authModal').classList.add('hidden'); }
function setAuthMode(mode) {
authMode = mode;
const tcRow = el('authTCRow');
if(tcRow) tcRow.style.display = mode === 'up' ? 'block' : 'none';
const tc = el('authTC');
if(tc) tc.checked = false;
el('tabIn').classList.toggle('on', mode==='in');
el('tabUp').classList.toggle('on', mode==='up');
el('authSubmit').textContent = mode==='in'?'Sign In':'Create Account';
clearAuthMsg();
}
function clearAuthMsg() { el('authMsg').classList.add('hidden'); }
function showAuthMsg(msg, type='err') {
const m=el('authMsg'); m.textContent=msg; m.className='auth-msg '+type; m.classList.remove('hidden');
}
async function doAuth() {
if(!sb) { toast('Supabase not configured -- running offline'); continueAsGuest(); return; }
if(authMode === 'up') {
const tc = el('authTC');
if(!tc || !tc.checked) {
showAuthMsg('Please accept the Terms of Use and Privacy Policy first.', 'err');
el('authTCRow').style.outline = '1.5px solid var(--violet)';
setTimeout(() => { if(el('authTCRow')) el('authTCRow').style.outline=''; }, 2000);
return;
}
}
const email = el('authEmail').value.trim();
const pass = el('authPass').value;
if(!email||!pass) { showAuthMsg('Please fill in both fields.'); return; }
if(pass.length<6) { showAuthMsg('Password must be at least 6 characters.'); return; }
el('authSubmit').disabled = true;
try {
let res;
if(authMode==='in') {
res = await sb.auth.signInWithPassword({email,password:pass});
if(res.error) { showAuthMsg(res.error.message==='Invalid login credentials'?'Wrong email or password. Try again.':res.error.message); return; }
state.user = res.data.user;
hideAuth();
updateUserUI();
syncToCloud();
showApp();
toast('Welcome back! \ud83d\udc4b');
} else {
res = await sb.auth.signUp({email,password:pass});
if(res.error) { showAuthMsg(res.error.message); return; }
if(res.data.user && res.data.session) {
state.user = res.data.user;
hideAuth();
updateUserUI();
showApp();
toast('Account created! Welcome to Focuz \ud83c\udfaf');
} else {
showAuthMsg('Account created! Signing you in...', 'ok');
const si = await sb.auth.signInWithPassword({email,password:pass});
if(!si.error && si.data.user) {
state.user = si.data.user;
hideAuth();
updateUserUI();
showApp();
toast('Welcome to Focuz \ud83c\udfaf');
} else {
showAuthMsg('Account created! Sign in with your email and password.','ok');
}
}
}
} catch(e) { showAuthMsg('Something went wrong. Try again.'); }
finally { el('authSubmit').disabled=false; }
}
async function signOut() {
if(sb) await sb.auth.signOut();
// Clear all local data so next user/guest starts fresh
state.user=null; state.isGuest=false;
state.sessions=[]; state.streak=0; state.gameScores={mem:0,cm:0,mb:0};
// Clear localStorage session data (keep theme preference)
const theme = localStorage.getItem('focuz_theme');
localStorage.clear();
if(theme) localStorage.setItem('focuz_theme', theme);
// Stop any running timer or sound
if(state.timerInterval) { clearInterval(state.timerInterval); state.timerInterval=null; }
stopAmbient();
// Go back to landing page
el('userMenu').classList.add('hidden');
updateUserUI();
updateStats();
showLanding();
toast('Signed out successfully.');
}
function continueAsGuest() {
state.isGuest=true;
// Always start fresh in guest mode \u2014 no leftover data from previous sessions
state.sessions=[];
state.streak=0;
state.gameScores={mem:0,cm:0,mb:0};
// Clear localStorage so stats show 0
const theme = localStorage.getItem('focuz_theme');
localStorage.clear();
if(theme) localStorage.setItem('focuz_theme', theme);
hideAuth();
el('guestBanner').classList.remove('hidden');
updateUserUI();
updateStats();
showApp();
}
function updateUserUI() {
const uw = el('userWrap');
if(state.user) {
const initial = (state.user.email||'?')[0].toUpperCase();
const nm = state.user.email.split('@')[0];
uw.innerHTML = `<div class="user-pill" id="userPill"><div class="user-av">${initial}</div><div class="user-nm">${nm}</div></div>`;
el('syncDot').className='sdot';
el('userPill').addEventListener('click',()=>el('userMenu').classList.toggle('hidden'));
} else {
uw.innerHTML = `<button class="signin-btn" id="topSignIn">Sign in</button>`;
el('topSignIn').addEventListener('click',showAuth);
el('syncDot').className='sdot off';
}
el('streakN').textContent = state.streak;
}
async function syncToCloud() {
if(!sb||!state.user) return;
el('syncDot').className='sdot syncing';
try {
const {data, error} = await sb
.from('sessions')
.select('id, duration_mins, task_name, created_at')
.eq('user_id', state.user.id)
.order('created_at', {ascending: false});
if(error) throw error;
if(data && data.length > 0) {
const remote = data.map(r => ({
id:   r.id,
date: r.created_at ? r.created_at.split('T')[0] : dateStr(new Date()),
mins: r.duration_mins || 0,
task: r.task_name || 'Focus session',
sound: 'brown' // sound not stored in DB, default to brown
}));
const localIds = new Set(state.sessions.map(s => s.id));
remote.forEach(r => { if(!localIds.has(r.id)) state.sessions.push(r); });
state.sessions.sort((a,b) => b.date.localeCompare(a.date));
LS.set('sessions', state.sessions);
}
const remoteIds = new Set((data||[]).map(r => r.id));
const toUpload = state.sessions.filter(s => !remoteIds.has(s.id));
if(toUpload.length > 0) {
const rows = toUpload.map(s => ({
user_id:      state.user.id,
duration_mins: s.mins,
task_name:     s.task || 'Focus session',
created_at:    s.date + 'T00:00:00.000Z'
}));
const {error: upErr} = await sb.from('sessions').insert(rows);
if(upErr) console.warn('Session upload error:', upErr.message);
}
await syncProfile();
el('syncDot').className = 'sdot';
} catch(e) {
console.warn('Sync error:', e);
el('syncDot').className = 'sdot off';
}
}
async function syncProfile() {
if(!sb||!state.user) return;
try {
const totalSessions = state.sessions.length;
const totalMins = state.sessions.reduce((a,s) => a + s.mins, 0);
const lastDate = state.sessions.length ? state.sessions[0].date : null;
await sb.from('profiles').upsert({
id:                state.user.id,
email:             state.user.email,
streak:            state.streak,
total_sessions:    totalSessions,
total_mins:        totalMins,
last_session_date: lastDate
}, {onConflict: 'id'});
} catch(e) { console.warn('Profile sync error:', e); }
}
function calcStreak() {
const today = dateStr(new Date());
const dates = [...new Set(state.sessions.map(s=>s.date))].sort().reverse();
if(!dates.length) { state.streak=0; return; }
let streak=0, cur=new Date();
for(let i=0;i<365;i++) {
const d=dateStr(cur);
if(dates.includes(d)) { streak++; cur.setDate(cur.getDate()-1); }
else if(i===0) { cur.setDate(cur.getDate()-1); continue; } // allow today to be incomplete
else break;
}
state.streak=streak;
el('streakN').textContent=streak;
el('streakBig').textContent=streak;
}
function dateStr(d) { return d.toISOString().split('T')[0]; }
function renderWeekDots() {
const wd=el('weekDots'); if(!wd) return;
wd.innerHTML='';
const days=['S','M','T','W','T','F','S'];
const today=new Date();
for(let i=6;i>=0;i--) {
const d=new Date(today); d.setDate(d.getDate()-i);
const ds=dateStr(d);
const isToday=i===0;
const hasSession=state.sessions.some(s=>s.date===ds);
const col=document.createElement('div');
col.className='wd-col';
col.innerHTML=`<div class="wd ${hasSession&&!isToday?'on':''} ${isToday?'today':''}"></div><div class="wd-lbl">${days[d.getDay()]}</div>`;
wd.appendChild(col);
}
calcStreak();
}
function updateStats() {
const total=state.sessions.length;
const totalMins=state.sessions.reduce((a,s)=>a+s.mins,0);
const todaySess=state.sessions.filter(s=>s.date===dateStr(new Date())).length;
el('stSess').textContent=total;
el('stMins').textContent=totalMins>=60?Math.round(totalMins/60)+'h':totalMins;
el('stToday').textContent=todaySess;
calcStreak();
}
function renderChart() {
const bars=el('chartBars'), days=el('chartDays');
if(!bars||!days) return;
bars.innerHTML=''; days.innerHTML='';
const dayLabels=['Su','Mo','Tu','We','Th','Fr','Sa'];
const today=new Date();
const data=[];
for(let i=6;i>=0;i--) {
const d=new Date(today); d.setDate(d.getDate()-i);
const ds=dateStr(d);
const sess=state.sessions.filter(s=>s.date===ds);
data.push({label:dayLabels[d.getDay()],count:sess.length,mins:sess.reduce((a,s)=>a+s.mins,0),isToday:i===0});
}
const maxCount=Math.max(...data.map(d=>d.count),1);
const weekTotal=data.reduce((a,d)=>a+d.count,0);
const weekMins=data.reduce((a,d)=>a+d.mins,0);
el('chartWeekTotal').textContent=`${weekTotal} session${weekTotal!==1?'s':''} this week`;
el('chartWeekMins').textContent=`${weekMins} min total`;
data.forEach(d=>{
const pct=Math.round((d.count/maxCount)*100);
const bw=document.createElement('div'); bw.className='chart-bar-wrap';
bw.innerHTML=`<div class="chart-bar-val">${d.count||''}</div><div class="chart-bar${d.isToday?' today':''}${d.count===0?' empty':''}" style="height:${Math.max(pct,3)}%"></div>`;
bars.appendChild(bw);
const dl=document.createElement('div'); dl.className='chart-day-lbl'+(d.isToday?' today':'');
dl.textContent=d.label; days.appendChild(dl);
});
}
function renderCalendar() {
const grid=el('calGrid'), mLabel=el('calMonth');
if(!grid) return;
const m=state.calMonth;
mLabel.textContent=m.toLocaleDateString('en',{month:'long',year:'numeric'});
const firstDay=new Date(m.getFullYear(),m.getMonth(),1).getDay();
const daysInMonth=new Date(m.getFullYear(),m.getMonth()+1,0).getDate();
const today=dateStr(new Date());
grid.innerHTML='';
['Su','Mo','Tu','We','Th','Fr','Sa'].forEach(d=>{
const h=document.createElement('div'); h.className='cal-hdr'; h.textContent=d; grid.appendChild(h);
});
for(let i=0;i<firstDay;i++) { grid.appendChild(document.createElement('div')); }
for(let d=1;d<=daysInMonth;d++) {
const ds=`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
const hasSess=state.sessions.some(s=>s.date===ds);
const isToday=ds===today;
const isSel=ds===state.calSel;
const cell=document.createElement('div');
cell.className='cal-day'+(hasSess?' has':'')+(isToday?' today':'')+(isSel?' sel':'');
cell.textContent=d;
if(hasSess) { const dot=document.createElement('div'); dot.className='cal-dot'; cell.appendChild(dot); }
cell.addEventListener('click',()=>{ state.calSel=ds; renderCalendar(); showCalDetail(ds); });
grid.appendChild(cell);
}
}
function showCalDetail(ds) {
const det=el('calDetail');
const sess=state.sessions.filter(s=>s.date===ds);
if(!sess.length) { det.style.display='none'; return; }
const d=new Date(ds+'T00:00');
det.style.display='block';
det.innerHTML=`<div class="cd-date">${d.toLocaleDateString('en',{weekday:'long',month:'long',day:'numeric'})}</div>`+
sess.map(s=>`<div class="cd-row"><div class="cd-mins">${s.mins}m</div><div class="cd-task">${s.task||'Focus session'}</div></div>`).join('');
}
const BADGES = [
{id:'first',ico:'\ud83c\udfaf',name:'First Session',check:()=>state.sessions.length>=1},
{id:'five',ico:'\ud83c\udf1f',name:'5 Sessions',check:()=>state.sessions.length>=5},
{id:'ten',ico:'\ud83d\udcaa',name:'10 Sessions',check:()=>state.sessions.length>=10},
{id:'fifty',ico:'\ud83d\udd25',name:'50 Sessions',check:()=>state.sessions.length>=50},
{id:'s3',ico:'\ud83d\udcc5',name:'3-Day Streak',check:()=>state.streak>=3},
{id:'s7',ico:'\u26a1',name:'7-Day Streak',check:()=>state.streak>=7},
{id:'s30',ico:'\ud83d\udc51',name:'30-Day Streak',check:()=>state.streak>=30},
{id:'hour',ico:'\u23f0',name:'1 Hour Focus',check:()=>state.sessions.some(s=>s.mins>=60)},
{id:'deep',ico:'\ud83e\udde0',name:'Deep Worker',check:()=>state.sessions.reduce((a,s)=>a+s.mins,0)>=300},
{id:'gmem',ico:'\ud83c\udfae',name:'Memory Pro',check:()=>state.gameScores.mem>=8},
{id:'gcm',ico:'\ud83c\udfa8',name:'Colour Master',check:()=>state.gameScores.cm>=20},
{id:'gmb',ico:'\ud83e\uddee',name:'Math Blitz Pro',check:()=>state.gameScores.mb>=20},
];
function renderBadges() {
const grid=el('badgesGrid'); if(!grid) return;
grid.innerHTML='';
if(state.isGuest || !state.user) {
const msg=document.createElement('div');
msg.style.cssText='grid-column:1/-1;text-align:center;padding:24px 16px;color:var(--tx3);font-size:13px;line-height:1.6;';
msg.innerHTML='<div style="font-size:28px;margin-bottom:8px">\ud83c\udfc6</div><strong style="color:var(--tx2);display:block;margin-bottom:4px">Sign in to earn badges</strong>Complete sessions and unlock achievements.';
grid.appendChild(msg);
return;
}
BADGES.forEach(b=>{
const earned=b.check();
const tile=document.createElement('div');
tile.className='badge-tile'+(earned?' earned':' locked');
tile.innerHTML=`<span class="b-ico">${b.ico}</span><div class="b-name">${b.name}</div>`;
grid.appendChild(tile);
});
}
function showWeeklyRecap() {
const today=new Date();
const start=new Date(today); start.setDate(today.getDate()-6);
el('wmRange').textContent=`${start.toLocaleDateString('en',{month:'short',day:'numeric'})} - ${today.toLocaleDateString('en',{month:'short',day:'numeric'})}`;
const week=[];
for(let i=6;i>=0;i--) { const d=new Date(today); d.setDate(d.getDate()-i); week.push(dateStr(d)); }
const weekSess=state.sessions.filter(s=>week.includes(s.date));
const weekMins=weekSess.reduce((a,s)=>a+s.mins,0);
const taskCount={};
weekSess.forEach(s=>{if(s.task){taskCount[s.task]=(taskCount[s.task]||0)+1;}});
const topTask=Object.entries(taskCount).sort((a,b)=>b[1]-a[1])[0];
el('rg1').textContent=weekSess.length;
el('rg2').textContent=weekMins;
el('rg3').textContent=state.streak;
const dayMins={}; weekSess.forEach(s=>{dayMins[s.date]=(dayMins[s.date]||0)+s.mins;});
const bestDay=Object.entries(dayMins).sort((a,b)=>b[1]-a[1])[0];
el('rg4').textContent=bestDay?new Date(bestDay[0]+'T00:00').toLocaleDateString('en',{weekday:'short'}):'--';
document.querySelector('.recap-top .rt-val').textContent=topTask?topTask[0]:'--';
const bars=el('recapBars'); bars.innerHTML='';
const days=['Su','Mo','Tu','We','Th','Fr','Sa'];
const maxS=Math.max(...week.map(d=>state.sessions.filter(s=>s.date===d).length),1);
week.forEach(d=>{
const cnt=state.sessions.filter(s=>s.date===d).length;
const pct=Math.round((cnt/maxS)*100);
const dLabel=days[new Date(d+'T00:00').getDay()];
bars.innerHTML+=`<div class="rb-row"><div class="rb-day">${dLabel}</div><div class="rb-track"><div class="rb-bar" style="width:${pct}%"></div></div><div class="rb-val">${cnt}</div></div>`;
});
el('weeklyModal').classList.remove('hidden');
}
let selPrio='mid';
function updateTaskUI() {
const list=el('taskList'), empty=el('taskEmpty'), cnt=el('taskCnt');
if(!list) return;
const tasks=state.tasks;
cnt.textContent=tasks.filter(t=>!t.done).length;
if(!tasks.length) { list.innerHTML=''; empty.style.display='block'; return; }
empty.style.display='none';
list.innerHTML=tasks.map(t=>`
<div class="task-item${t.done?' ti-done':''}${state.focusTaskId===t.id?' ti-focus':''}" data-id="${t.id}">
<div class="ti-check">${t.done?'\u2713':''}</div>
<div class="ti-body">
<div class="ti-name">${escHtml(t.name)}</div>
<span class="ti-prio tp-${t.prio[0]}">${t.prio}</span>
</div>
${state.focusTaskId===t.id?'<span class="ti-focus-badge">FOCUS</span>':''}
<button class="ti-del" data-id="${t.id}" title="Delete">\u2715</button>
</div>`).join('');
list.querySelectorAll('.task-item').forEach(item=>{
item.addEventListener('click',e=>{
if(e.target.classList.contains('ti-del')) return;
const id=item.dataset.id;
if(state.focusTaskId===id) {
const t=state.tasks.find(t=>t.id===id);
if(t) t.done=!t.done;
} else {
state.focusTaskId=id;
const t=state.tasks.find(t=>t.id===id);
if(t) el('intentionIn').value=t.name;
updateIntentionUI();
}
LS.set('tasks',state.tasks); updateTaskUI();
});
});
list.querySelectorAll('.ti-del').forEach(btn=>{
btn.addEventListener('click',e=>{
e.stopPropagation();
state.tasks=state.tasks.filter(t=>t.id!==btn.dataset.id);
if(state.focusTaskId===btn.dataset.id) state.focusTaskId=null;
LS.set('tasks',state.tasks); updateTaskUI();
});
});
}
function escHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function addTask() {
const inp=el('taskIn'); const name=inp.value.trim(); if(!name) return;
const task={id:Date.now().toString(),name,prio:selPrio,done:false};
state.tasks.unshift(task); LS.set('tasks',state.tasks);
inp.value=''; updateTaskUI();
}
function updateIntentionUI() {
const v=el('intentionIn').value;
const pill=el('focusPill');
const cnt=el('intCnt');
cnt.classList.toggle('hidden', !v);
cnt.textContent=`${v.length}/80`;
cnt.classList.toggle('warn',v.length>60);
cnt.classList.toggle('full',v.length>=75);
if(v) {
pill.textContent='\ud83c\udfaf '+v;
pill.className='focus-pill fp-a';
} else {
pill.textContent='\ud83d\udc46 Type your intention above';
pill.className='focus-pill fp-e';
}
suggestSound(v);
}
function suggestSound(v) {
const low=v.toLowerCase();
const sug=el('soundSuggest');
let rec=null;
if(/cod|dev|debug|program/.test(low)) rec={s:'brown',lbl:'\ud83c\udfa7 Focus mode recommended for coding'};
else if(/write|essay|blog|report/.test(low)) rec={s:'ocean',lbl:'\ud83d\udca4 Sleep sound recommended for writing'};
else if(/read|study|learn|research/.test(low)) rec={s:'rain',lbl:'\ud83c\udf27\ufe0f Rain recommended for studying'};
else if(/creat|design|art|brainstorm/.test(low)) rec={s:'bass',lbl:'\ud83e\uddd8 Calm mode recommended for creative work'};
if(rec && state.selectedSound!==rec.s) {
sug.style.display='block'; sug.textContent=rec.lbl;
sug._sound=rec.s;
} else { sug.style.display='none'; }
}
const CIRC=2*Math.PI*86; // r=86
function setTimerMins(mins) {
if(state.running) return;
state.timerMins=mins; state.totalSecs=mins*60; state.timerSecs=0;
updateTimerDisplay(mins*60, mins*60);
}
function updateTimerDisplay(remaining, total) {
const m=Math.floor(remaining/60), s=remaining%60;
el('rDig').textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
const prog=1-(remaining/total);
const offset=CIRC*(1-prog);
el('rProg').style.strokeDashoffset=offset;
el('rGlow').style.strokeDashoffset=offset;
}
function startTimer() {
if(state.inBreak) return;
state.running=true; state.paused=false;
el('playBtn').textContent='\u23f8';
el('playBtn').classList.add('playing');
el('timerCard').classList.add('running');
el('rStat').textContent='focusing...';
startAmbient();
startViz();
runTick();
}
function pauseTimer() {
state.running=false; state.paused=true;
clearInterval(state.tickInterval);
el('playBtn').textContent='\u25b6';
el('playBtn').classList.remove('playing');
el('timerCard').classList.remove('running');
el('rStat').textContent='paused';
stopAmbient();
stopViz();
}
function resetTimer() {
clearInterval(state.tickInterval);
state.running=false; state.paused=false;
state.timerSecs=0;
el('playBtn').textContent='\u25b6';
el('playBtn').classList.remove('playing');
el('timerCard').classList.remove('running');
el('rStat').textContent='tap play to start';
updateTimerDisplay(state.timerMins*60, state.timerMins*60);
stopAmbient(); stopViz();
}
function runTick() {
let remaining=state.timerMins*60-state.timerSecs;
clearInterval(state.tickInterval);
state.tickInterval=setInterval(()=>{
if(!state.running) return;
state.timerSecs++;
remaining=state.timerMins*60-state.timerSecs;
updateTimerDisplay(remaining, state.timerMins*60);
if(remaining<=0) { clearInterval(state.tickInterval); sessionComplete(); }
},1000);
}
function skipTimer() {
clearInterval(state.tickInterval);
state.running=false; state.timerSecs=0;
stopAmbient(); stopViz();
if(state.inBreak) endBreak();
else {
resetTimer();
switchToNextPomoCycle();
}
}
function sessionComplete() {
state.running=false; stopAmbient(); stopViz();
el('playBtn').textContent='\u25b6'; el('playBtn').classList.remove('playing');
el('timerCard').classList.remove('running');
playChime();
const id = (typeof crypto !== 'undefined' && crypto.randomUUID)
? crypto.randomUUID()
: Date.now().toString(36) + Math.random().toString(36).slice(2);
const sess = {
id,
date:  dateStr(new Date()),
mins:  state.timerMins,
task:  el('intentionIn').value.trim() || 'Focus session',
sound: state.selectedSound
};
if(state.user && !state.isGuest) {
state.sessions.unshift(sess);
LS.set('sessions', state.sessions);
updateStats();
renderWeekDots();
calcStreak();
syncToCloud();
}
showCompleteOverlay(sess);
showShareCard(sess);
if(state.pomodoroOn) advancePomoCycle();
}
const MOTIVES=[
"Every minute of deep work builds your future.",
"Consistency beats intensity every time.",
"You just compounded your skills.",
"Progress is progress -- no matter how small.",
"One session closer to mastery.",
];
function showCompleteOverlay(sess) {
const overlay=el('completeOverlay');
el('coMsg').textContent=`You focused for ${sess.mins} minutes on "${sess.task}".`;
el('coMotive').textContent=MOTIVES[Math.floor(Math.random()*MOTIVES.length)];
const hasFocusTask=state.focusTaskId && state.tasks.find(t=>t.id===state.focusTaskId&&!t.done);
el('coDone').classList.toggle('hidden',!hasFocusTask);
overlay.classList.add('show');
}
function updatePomoCycles() {
const cycs=el('pomoCycles');
if(!state.pomodoroOn) { cycs.classList.add('hidden'); return; }
cycs.classList.remove('hidden');
for(let i=1;i<=4;i++) {
const c=el('pc'+i);
c.classList.toggle('done', i<=state.pomoCycle);
c.classList.toggle('cur', i===state.pomoCycle+1&&!state.inBreak);
}
}
function advancePomoCycle() {
state.pomoCycle=(state.pomoCycle+1)%4;
updatePomoCycles();
const isLong=state.pomoCycle===0;
startBreak(isLong?15:5, isLong);
}
function switchToNextPomoCycle() {
updatePomoCycles();
}
function startBreak(mins, isLong=false) {
state.inBreak=true; state.breakSecs=0;
const total=mins*60;
const bkCirc=2*Math.PI*58;
el('breakEmoji').textContent=isLong?'\ud83d\udecb\ufe0f':'\u2615';
el('breakTitle').textContent=isLong?'Long Break! \ud83d\udecb\ufe0f':'Short Break! \u2615';
el('breakMsg').textContent=isLong?'You finished 4 sessions! Take 15 minutes.':'Nice work! Take 5 minutes to recharge.';
el('breakOverlay').classList.remove('hidden');
state.timerSecs=0;
let breakPaused=false;
clearInterval(state.breakInterval);
function updateBreak() {
const rem=total-state.breakSecs;
const m=Math.floor(rem/60), s=rem%60;
el('breakDig').textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
const prog=(state.breakSecs/total);
el('bkProg').style.strokeDashoffset=bkCirc*(1-prog);
if(rem<=0) { clearInterval(state.breakInterval); endBreak(); }
}
updateBreak();
state.breakInterval=setInterval(()=>{
if(breakPaused) return;
state.breakSecs++; updateBreak();
},1000);
el('brkSkip').onclick=()=>endBreak();
el('brkPause').onclick=()=>{
breakPaused=!breakPaused;
el('brkPause').textContent=breakPaused?'\u25b6 Resume':'\u23f8 Pause';
};
}
function endBreak() {
state.inBreak=false; clearInterval(state.breakInterval);
el('breakOverlay').classList.add('hidden');
resetTimer();
toast('Break over! Ready to focus again? \ud83c\udfaf');
}
function getAudioCtx() {
if(!state.audioCtx) state.audioCtx=new (window.AudioContext||window.webkitAudioContext)();
return state.audioCtx;
}
function stopAmbient() {
if(state._rainTimer){ clearTimeout(state._rainTimer); state._rainTimer=null; }
(state.oscNodes||[]).forEach(o=>{ try{o.stop();}catch{} });
state.oscNodes=[];
try { if(state.ambientNode){ state.ambientNode.stop(); state.ambientNode=null; } } catch{}
try { if(state.gainNode){ state.gainNode.disconnect(); state.gainNode=null; } } catch{}
}
function startAmbient() {
if(!state.ambientOn || state.selectedSound==='none') return;
stopAmbient();
try {
const ctx = getAudioCtx();
if(ctx.state === 'suspended') ctx.resume();
const master = ctx.createGain();
master.connect(ctx.destination);
const snd = state.selectedSound;
const SR  = ctx.sampleRate;
const LEN = Math.floor(SR * 0.5);
if(snd === 'brown') {
master.gain.value = 0.5;
const buf=ctx.createBuffer(1,LEN,SR); const d=buf.getChannelData(0);
let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0,b6=0;
for(let i=0;i<LEN;i++){
const w=Math.random()*2-1;
b0=0.99886*b0+w*0.0555179; b1=0.99332*b1+w*0.0750759;
b2=0.96900*b2+w*0.1538520; b3=0.86650*b3+w*0.3104856;
b4=0.55000*b4+w*0.5329522; b5=-0.7616*b5-w*0.0168980;
d[i]=(b0+b1+b2+b3+b4+b5+b6+w*0.5362)*0.11; b6=w*0.115926;
}
const node=ctx.createBufferSource(); node.buffer=buf; node.loop=true;
const lpf=ctx.createBiquadFilter(); lpf.type='lowpass'; lpf.frequency.value=300;
node.connect(lpf); lpf.connect(master); node.start();
state.ambientNode=node;
} else if(snd === 'ocean') {
master.gain.value = 0.45;
const buf=ctx.createBuffer(1,LEN,SR); const d=buf.getChannelData(0);
let pb0=0,pb1=0,pb2=0;
for(let i=0;i<LEN;i++){
const w=Math.random()*2-1;
pb0=0.99765*pb0+w*0.0990460;
pb1=0.96300*pb1+w*0.2965164;
pb2=0.57000*pb2+w*1.0526913;
d[i]=(pb0+pb1+pb2+w*0.1848)*0.11;
}
const node=ctx.createBufferSource(); node.buffer=buf; node.loop=true;
const lpf2k=ctx.createBiquadFilter(); lpf2k.type='lowpass'; lpf2k.frequency.value=2000;
node.connect(lpf2k); lpf2k.connect(master); node.start();
state.ambientNode=node;
} else if(snd === 'rain') {
master.gain.value = 0.55;
const hissLen=Math.floor(SR*1.5);
const hissBuf=ctx.createBuffer(1,hissLen,SR);
const hd=hissBuf.getChannelData(0);
let hb0=0,hb1=0,hb2=0;
for(let i=0;i<hissLen;i++){
const w=Math.random()*2-1;
hb0=0.99765*hb0+w*0.0990460;
hb1=0.96300*hb1+w*0.2965164;
hb2=0.57000*hb2+w*1.0526913;
hd[i]=(hb0+hb1+hb2+w*0.1848)*0.05;
}
const hissNode=ctx.createBufferSource(); hissNode.buffer=hissBuf; hissNode.loop=true;
const bpf=ctx.createBiquadFilter(); bpf.type='bandpass';
bpf.frequency.value=700; bpf.Q.value=0.5;
const hissGain=ctx.createGain(); hissGain.gain.value=0.55;
hissNode.connect(bpf); bpf.connect(hissGain); hissGain.connect(master);
hissNode.start();
state.ambientNode=hissNode;
const dropGain=ctx.createGain(); dropGain.gain.value=0.7; dropGain.connect(master);
const scheduleDrops=()=>{
if(!state.gainNode) return;
const now=ctx.currentTime;
const count=2+Math.floor(Math.random()*3);
for(let i=0;i<count;i++){
const t=now+Math.random()*0.7;
const vol=0.05+Math.random()*0.1;
const dropLen=Math.floor(SR*0.06);
const dropBuf=ctx.createBuffer(1,dropLen,SR);
const dd=dropBuf.getChannelData(0);
for(let j=0;j<dropLen;j++){
dd[j]=(Math.random()*2-1)*Math.exp(-j/(SR*0.018));
}
const dn=ctx.createBufferSource(); dn.buffer=dropBuf;
const dg=ctx.createGain(); dg.gain.value=vol;
const dpf=ctx.createBiquadFilter(); dpf.type='bandpass';
dpf.frequency.value=400+Math.random()*400; dpf.Q.value=1.2;
dn.connect(dpf); dpf.connect(dg); dg.connect(dropGain);
dn.start(t);
}
state._rainTimer=setTimeout(scheduleDrops,600);
};
scheduleDrops();
} else if(snd === 'bass') {
master.gain.value = 0.45;
state.oscNodes = [];
const BOWL_FREQS = [432, 528, 396];
const strikeBowl = (freq) => {
if(!state.gainNode) return;
const totalSecs = 9;
const bowlLen = Math.floor(SR * totalSecs);
const bowlBuf = ctx.createBuffer(1, bowlLen, SR);
const bd = bowlBuf.getChannelData(0);
for(let i = 0; i < bowlLen; i++){
const t = i / SR;
let env;
if(t < 1.5){
env = t / 1.5; // 1.5s attack -- smooth fade in
} else {
env = Math.exp(-(t - 1.5) / 4.0); // 4s time constant decay
}
const wobble = 0.5 * Math.sin(2 * Math.PI * 0.12 * t);
const s =
0.60 * Math.sin(2 * Math.PI * (freq + wobble) * t) +
0.25 * Math.sin(2 * Math.PI * (freq * 2 + wobble * 2) * t) +
0.08 * Math.sin(2 * Math.PI * (freq * 3) * t);
bd[i] = s * env * 0.4;
}
const node = ctx.createBufferSource();
node.buffer = bowlBuf;
const lpf = ctx.createBiquadFilter();
lpf.type = 'lowpass'; lpf.frequency.value = 2000;
node.connect(lpf); lpf.connect(master);
node.start();
const nextFreq = BOWL_FREQS[Math.floor(Math.random() * BOWL_FREQS.length)];
const nextIn = 12000 + Math.random() * 8000;
state._rainTimer = setTimeout(() => strikeBowl(nextFreq), nextIn);
};
state._rainTimer = setTimeout(() => strikeBowl(432), 1000);
state.ambientNode = null;
}
state.gainNode=master;
} catch(e){ console.warn('Audio error:',e); }
}
function playChime() {
if(!state.chimeOn) return;
try {
const ctx=getAudioCtx();
[0,0.15,0.3].forEach((t,i)=>{
const o=ctx.createOscillator(), g=ctx.createGain();
o.connect(g); g.connect(ctx.destination);
o.frequency.value=[523,659,784][i];
o.type='sine';
g.gain.setValueAtTime(0,ctx.currentTime+t);
g.gain.linearRampToValueAtTime(0.3,ctx.currentTime+t+0.05);
g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+t+0.8);
o.start(ctx.currentTime+t); o.stop(ctx.currentTime+t+0.85);
});
} catch{}
}
function buildViz() {
const v=el('viz'); v.innerHTML='';
const heights=[4,7,10,14,18,14,10,7,4];
heights.forEach((h,i)=>{
const b=document.createElement('div'); b.className='vbar';
b.style.cssText=`height:${h}px;--spd:${0.4+i*0.07}s`;
v.appendChild(b);
});
}
function startViz() { el('viz').querySelectorAll('.vbar').forEach(b=>b.classList.add('live')); }
function stopViz() { el('viz').querySelectorAll('.vbar').forEach(b=>b.classList.remove('live')); }
const SOUND_META = {
brown:{emoji:'\ud83c\udfa7',label:'Focus (Brown Noise)'},
ocean:{emoji:'\uD83C\uDF0A',label:'Ocean Waves'},
rain: {emoji:'\ud83c\udf27\ufe0f',label:'Rain'},
bass: {emoji:'\ud83e\uddd8',label:'Calm (Bass)'},
none: {emoji:'\ud83d\udd07',label:'No Sound'},
};
function showShareCard(sess) {
el('shareCardModal').classList.remove('hidden');
drawShareCard(sess);
const APP_URL = 'https://getfocuzapp.github.io/focuz';
const shareText = 'Just locked in ' + sess.mins + ' mins of deep work! Building my focus habit with Focuz \uD83C\uDFAF ' + APP_URL;
let cachedBlob = null;
el('shareCanvas').toBlob(b => { cachedBlob = b; }, 'image/png');
el('scNative').onclick = async () => {
try {
if(!cachedBlob) cachedBlob = await new Promise(r => el('shareCanvas').toBlob(r, 'image/png'));
const file = new File([cachedBlob], 'focuz-session.png', {type:'image/png'});
if(navigator.canShare && navigator.canShare({files:[file]})){
await navigator.share({files:[file], title:'My Focuz Session', text:shareText});
return;
}
downloadCard(sess);
toast('Image saved! Share from your gallery \uD83D\uDCF7');
} catch(e){
if(e.name !== 'AbortError'){
downloadCard(sess);
toast('Image saved! Share from your gallery \uD83D\uDCF7');
}
}
};
el('scDownload').onclick = () => {
downloadCard(sess);
toast('Image saved to your gallery! \uD83D\uDCF8');
};
el('scClose').onclick = () => el('shareCardModal').classList.add('hidden');
}
function drawShareCard(sess) {
const canvas = el('shareCanvas');
const ctx = canvas.getContext('2d');
const W = 960, H = 960;
canvas.width = W; canvas.height = H;
ctx.clearRect(0,0,W,H);
const bg = ctx.createLinearGradient(0,0,W,H);
bg.addColorStop(0,   '#0a0818');
bg.addColorStop(0.5, '#0e0d2a');
bg.addColorStop(1,   '#080717');
ctx.fillStyle = bg;
ctx.fillRect(0,0,W,H);
const orb = ctx.createRadialGradient(W*0.85, H*0.1, 0, W*0.85, H*0.1, W*0.45);
orb.addColorStop(0,'rgba(100,60,220,0.28)');
orb.addColorStop(1,'rgba(100,60,220,0)');
ctx.fillStyle=orb; ctx.fillRect(0,0,W,H);
const orb2 = ctx.createRadialGradient(W*0.1, H*0.88, 0, W*0.1, H*0.88, W*0.35);
orb2.addColorStop(0,'rgba(180,60,140,0.18)');
orb2.addColorStop(1,'rgba(180,60,140,0)');
ctx.fillStyle=orb2; ctx.fillRect(0,0,W,H);
const PAD = 72;
const logoBoxW = 210, logoBoxH = 80, logoBoxR = 16;
const logoBg = ctx.createLinearGradient(PAD, 60, PAD+logoBoxW, 60+logoBoxH);
logoBg.addColorStop(0,'#f472b6'); logoBg.addColorStop(0.5,'#8b5cf6'); logoBg.addColorStop(1,'#2dd4bf');
ctx.fillStyle = logoBg;
roundRect(ctx, PAD, 60, logoBoxW, logoBoxH, logoBoxR);
ctx.fill();
ctx.fillStyle = '#fff';
ctx.font = 'italic 900 44px serif';
ctx.textAlign = 'left';
ctx.textBaseline = 'middle';
ctx.fillText('focuz', PAD+22, 60+logoBoxH/2+2);
const badgeText = 'DEEP WORK  \u2713';
ctx.font = '700 26px sans-serif';
const badgeW = ctx.measureText(badgeText).width + 48;
const badgeH = 52;
const badgeX = W - PAD - badgeW;
const badgeY = 60;
ctx.fillStyle = 'rgba(255,255,255,0.07)';
roundRect(ctx, badgeX, badgeY, badgeW, badgeH, badgeH/2);
ctx.fill();
ctx.strokeStyle = 'rgba(255,255,255,0.18)';
ctx.lineWidth = 1.5;
roundRect(ctx, badgeX, badgeY, badgeW, badgeH, badgeH/2);
ctx.stroke();
ctx.fillStyle = 'rgba(220,215,255,0.85)';
ctx.textAlign = 'center';
ctx.textBaseline = 'middle';
ctx.fillText(badgeText, badgeX+badgeW/2, badgeY+badgeH/2+1);
ctx.textAlign = 'left';
ctx.textBaseline = 'alphabetic';
ctx.fillStyle = 'rgba(160,150,210,0.7)';
ctx.font = '600 28px sans-serif';
ctx.fillText('JUST LOCKED IN  \uD83D\uDD12', PAD, 220);
const taskText = sess.task && sess.task !== 'Focus session' ? sess.task : 'Focus Session';
ctx.fillStyle = '#f0eeff';
ctx.font = '800 88px sans-serif';
let displayTask = taskText;
while(ctx.measureText(displayTask).width > W - PAD*2 - 20 && displayTask.length > 2) {
displayTask = displayTask.slice(0,-1);
}
if(displayTask !== taskText) displayTask += '...';
ctx.fillText(displayTask, PAD, 330);
const pillY = 390;
const pillH = 72;
const pillR  = pillH/2;
const durationText = sess.mins + ' min';
ctx.font = '700 32px sans-serif';
const durW = ctx.measureText(durationText).width + 60;
ctx.fillStyle = '#6d3fd6';
roundRect(ctx, PAD, pillY, durW, pillH, pillR);
ctx.fill();
ctx.fillStyle = '#fff';
ctx.textAlign = 'center';
ctx.textBaseline = 'middle';
ctx.fillText(durationText, PAD + durW/2, pillY + pillH/2 + 1);
const sm = SOUND_META[sess.sound] || SOUND_META.brown;
const soundText = sm.label + '  ' + sm.emoji;
ctx.font = '700 32px sans-serif';
const soundW = ctx.measureText(soundText).width + 60;
const soundX = PAD + durW + 22;
ctx.fillStyle = 'rgba(45,212,191,0.1)';
roundRect(ctx, soundX, pillY, soundW, pillH, pillR);
ctx.fill();
ctx.strokeStyle = '#2dd4bf';
ctx.lineWidth = 2.5;
roundRect(ctx, soundX, pillY, soundW, pillH, pillR);
ctx.stroke();
ctx.fillStyle = '#2dd4bf';
ctx.fillText(soundText, soundX + soundW/2, pillY + pillH/2 + 1);
const streakVal = state.user ? state.streak : 0;
const streakText = '\uD83D\uDD25  ' + (streakVal||1) + ' day streak';
ctx.font = '600 30px sans-serif';
const streakW = ctx.measureText(streakText).width + 56;
const streakY = pillY + pillH + 24;
ctx.fillStyle = 'rgba(255,255,255,0.06)';
roundRect(ctx, PAD, streakY, streakW, 64, 32);
ctx.fill();
ctx.strokeStyle = 'rgba(255,255,255,0.15)';
ctx.lineWidth = 1.5;
roundRect(ctx, PAD, streakY, streakW, 64, 32);
ctx.stroke();
ctx.fillStyle = 'rgba(240,238,255,0.9)';
ctx.textAlign = 'center';
ctx.textBaseline = 'middle';
ctx.fillText(streakText, PAD + streakW/2, streakY + 32);
const quote = SHARE_QUOTES[Math.floor(Math.random() * SHARE_QUOTES.length)];
const quoteY = streakY + 64 + 52;
const borderGrad = ctx.createLinearGradient(0, quoteY-10, 0, quoteY+80);
borderGrad.addColorStop(0,'#8b5cf6'); borderGrad.addColorStop(1,'#2dd4bf');
ctx.fillStyle = borderGrad;
ctx.fillRect(PAD, quoteY-10, 5, 90);
ctx.fillStyle = 'rgba(190,185,230,0.85)';
ctx.font = 'italic 500 30px serif';
ctx.textAlign = 'left';
ctx.textBaseline = 'alphabetic';
const quoteStr = '\u201C' + quote.t + '\u201D';
const qLines = wrapText(ctx, quoteStr, W - PAD - 80, PAD+28);
qLines.forEach((ln,i) => ctx.fillText(ln, PAD+28, quoteY + i*40));
const bottomY = H - 56;
ctx.fillStyle = 'rgba(130,120,180,0.65)';
ctx.font = '400 26px sans-serif';
ctx.textAlign = 'left';
ctx.textBaseline = 'alphabetic';
ctx.fillText('try focuz free \u2192', PAD, bottomY);
const urlText = 'getfocuzapp.netlify.app';
ctx.font = '600 26px sans-serif';
const urlW = ctx.measureText(urlText).width + 28;
const urlX = W - PAD - urlW;
const urlBoxH = 40;
const urlBg = ctx.createLinearGradient(urlX, 0, urlX+urlW, 0);
urlBg.addColorStop(0,'#f472b6'); urlBg.addColorStop(1,'#8b5cf6');
ctx.fillStyle = urlBg;
roundRect(ctx, urlX, bottomY-urlBoxH+8, urlW, urlBoxH, 6);
ctx.fill();
ctx.fillStyle = '#fff';
ctx.textAlign = 'right';
ctx.fillText(urlText, W - PAD - 14, bottomY);
}
function wrapText(ctx, text, maxW, startX) {
const words = text.split(' ');
const lines = [];
let cur = '';
words.forEach(w => {
const test = cur ? cur + ' ' + w : w;
if(ctx.measureText(test).width <= maxW) { cur = test; }
else { if(cur) lines.push(cur); cur = w; }
});
if(cur) lines.push(cur);
return lines;
}
function roundRect(ctx, x, y, w, h, r) {
ctx.beginPath();
ctx.moveTo(x+r,y); ctx.lineTo(x+w-r,y);
ctx.quadraticCurveTo(x+w,y,x+w,y+r);
ctx.lineTo(x+w,y+h-r); ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
ctx.lineTo(x+r,y+h); ctx.quadraticCurveTo(x,y+h,x,y+h-r);
ctx.lineTo(x,y+r); ctx.quadraticCurveTo(x,y,x+r,y);
ctx.closePath();
}
function downloadCard(sess) {
const canvas = el('shareCanvas');
const link = document.createElement('a');
link.download = 'focuz-session-' + sess.date + '.png';
link.href = canvas.toDataURL('image/png');
link.click();
toast('Image saved! \ud83d\udcf8');
}
async function nativeShareCard(sess) {
const canvas = el('shareCanvas');
try {
const blob = await new Promise(r=>canvas.toBlob(r,'image/png'));
const file = new File([blob],'focuz-session.png',{type:'image/png'});
if(navigator.canShare && navigator.canShare({files:[file]})) {
await navigator.share({
title:'My Focuz Session \ud83c\udfaf',
text:'Just completed a '+sess.mins+'-minute deep work session! Building my focus habit with Focuz \ud83d\udcaa getfocuzapp.netlify.app',
files:[file]
});
} else {
downloadCard(sess);
}
} catch(e){ downloadCard(sess); }
}
const SHARE_QUOTES = [
{t:"Every minute of deep work builds your future.",a:"Focuz"},
{t:"Consistency beats intensity every time.",a:"Cal Newport"},
{t:"The expert at anything was once a beginner.",a:"Helen Hayes"},
{t:"Small steps every day lead to giant leaps.",a:"Focuz"},
{t:"Focus is the art of saying no to distractions.",a:"Cal Newport"},
{t:"You just invested in your future self.",a:"Focuz"},
{t:"Progress is impossible without change.",a:"G.B. Shaw"},
{t:"One session closer to mastery.",a:"Focuz"},
];
let memState={level:3,running:false};
function showMemScreen(id) {
['msc-start','msc-show','msc-input','msc-over'].forEach(s=>el(s).style.display='none');
el(id).style.display='';
}
function startMemGame() {
memState={level:3,running:true};
showNextMemRound();
}
function showNextMemRound() {
const num=Array.from({length:memState.level},()=>Math.floor(Math.random()*10)).join('');
memState.current=num;
el('memLevel').textContent=`Level ${memState.level-2} \u00b7 ${memState.level} digits`;
el('memNum').textContent=num;
showMemScreen('msc-show');
setTimeout(()=>{
el('memLevel2').textContent=`What was the ${memState.level}-digit number?`;
el('memIn').value='';
showMemScreen('msc-input');
setTimeout(()=>el('memIn').focus(),50);
}, 1000+memState.level*400);
}
function submitMem() {
const ans=el('memIn').value.trim();
if(ans===memState.current) {
memState.level++;
showNextMemRound();
} else {
endMemGame();
}
}
function endMemGame() {
const reached=memState.level;
if(reached>state.gameScores.mem) { state.gameScores.mem=reached; LS.set('gameScores',state.gameScores); updateGameHiCards(); }
el('memEmoji').textContent=reached>=10?'\ud83c\udfc6':reached>=7?'\ud83e\udd29':'\ud83d\ude05';
el('memOverTitle').textContent=reached>=8?'Amazing memory!':'Good try!';
el('memOverSub').textContent=`You reached ${reached} digits.`;
el('memReached').textContent=reached;
el('memHiNum').textContent=state.gameScores.mem;
showMemScreen('msc-over');
}
const CM_COLORS={RED:'#ef4444',BLUE:'#3b82f6',GREEN:'#10b981',YELLOW:'#f59e0b',PURPLE:'#8b5cf6',ORANGE:'#f97316'};
let cmState={};
function showCmScreen(id) {
['cmc-start','cmc-play','cmc-over'].forEach(s=>el(s).style.display='none');
el(id).style.display='';
}
function startCM() {
cmState={right:0,wrong:0,lives:3,streak:0,running:true};
nextCMRound();
showCmScreen('cmc-play');
}
function nextCMRound() {
const words=Object.keys(CM_COLORS);
const word=words[Math.floor(Math.random()*words.length)];
const inkWord=words[Math.floor(Math.random()*words.length)];
cmState.match=(word===inkWord);
el('cmWord').textContent=word;
el('cmWord').style.color=CM_COLORS[inkWord];
el('cmFeedback').textContent='';
updateCMUI();
}
function updateCMUI() {
el('cmStreakDisp').textContent='\ud83d\udd25 '+cmState.streak;
el('cmLivesDisp').textContent='\u2764\ufe0f'.repeat(cmState.lives)+'\ud83d\udda4'.repeat(3-cmState.lives);
el('cmRight').textContent=cmState.right;
el('cmWrong').textContent=cmState.wrong;
}
function answerCM(isMatch) {
if(!cmState.running) return;
const correct=(isMatch===cmState.match);
if(correct) {
cmState.right++; cmState.streak++;
el('cmFeedback').textContent='\u2705';
} else {
cmState.wrong++; cmState.lives--; cmState.streak=0;
el('cmFeedback').textContent='\u274c';
}
if(cmState.lives<=0) { setTimeout(endCM,400); return; }
setTimeout(nextCMRound, 300);
}
function endCM() {
cmState.running=false;
const score=cmState.right;
if(score>state.gameScores.cm) { state.gameScores.cm=score; LS.set('gameScores',state.gameScores); updateGameHiCards(); }
el('cmEmoji').textContent=score>=25?'\ud83c\udfc6':score>=15?'\ud83e\udd29':'\ud83c\udfa8';
el('cmOverTitle').textContent=score>=20?'Colour Champion!':'Game Over!';
el('cmOverSub').textContent=`You got ${score} correct answers.`;
el('cmFinalRight').textContent=score;
el('cmFinalHi').textContent=state.gameScores.cm;
showCmScreen('cmc-over');
}
let mbState={};
function showMbScreen(id) {
['mbc-start','mbc-play','mbc-over'].forEach(s=>el(s).style.display='none');
el(id).style.display='';
}
function startMB() {
mbState={score:0,lives:3,streak:0,running:true,timePerQ:4000};
showMbScreen('mbc-play');
nextMBRound();
}
function nextMBRound() {
if(!mbState.running) return;
const ops=['+','-','\u00d7'];
const op=ops[Math.floor(Math.random()*ops.length)];
let a,b,ans;
if(op==='+'){a=Math.floor(Math.random()*20)+1;b=Math.floor(Math.random()*20)+1;ans=a+b;}
else if(op==='-'){a=Math.floor(Math.random()*20)+10;b=Math.floor(Math.random()*a)+1;ans=a-b;}
else{a=Math.floor(Math.random()*12)+1;b=Math.floor(Math.random()*12)+1;ans=a*b;}
mbState.answer=ans;
const wrongs=new Set();
while(wrongs.size<3){const w=ans+Math.floor(Math.random()*10)-5;if(w!==ans&&w>0)wrongs.add(w);}
const opts=[ans,...wrongs].sort(()=>Math.random()-0.5);
el('mbQuestion').textContent=`${a} ${op} ${b} = ?`;
el('mbFeedback').textContent='';
el('mbScore').textContent=mbState.score;
el('mbLives').textContent='\u2764\ufe0f'.repeat(mbState.lives)+'\ud83d\udda4'.repeat(3-mbState.lives);
el('mbStreak').textContent='\ud83d\udd25 '+mbState.streak;
const bar=el('mbBar');
bar.style.transition='none'; bar.style.width='100%';
setTimeout(()=>{ bar.style.transition=`width ${mbState.timePerQ}ms linear`; bar.style.width='0%'; },50);
mbState.timeout=setTimeout(()=>{ if(mbState.running) loseLifeMB(); },mbState.timePerQ);
const grid=el('mbGrid'); grid.innerHTML='';
opts.forEach(opt=>{
const btn=document.createElement('button'); btn.className='mb-opt'; btn.textContent=opt;
btn.addEventListener('click',()=>answerMB(opt));
grid.appendChild(btn);
});
}
function answerMB(val) {
if(!mbState.running) return;
clearTimeout(mbState.timeout);
if(val===mbState.answer) {
mbState.score++; mbState.streak++;
el('mbFeedback').textContent='\u2705';
if(mbState.score%10===0) mbState.timePerQ=Math.max(mbState.timePerQ-400,1200);
setTimeout(nextMBRound,300);
} else { loseLifeMB(); }
}
function loseLifeMB() {
mbState.lives--; mbState.streak=0;
el('mbFeedback').textContent='\u274c';
if(mbState.lives<=0) { setTimeout(endMB,400); return; }
setTimeout(nextMBRound,400);
}
function endMB() {
mbState.running=false; clearTimeout(mbState.timeout);
const score=mbState.score;
if(score>state.gameScores.mb) { state.gameScores.mb=score; LS.set('gameScores',state.gameScores); updateGameHiCards(); }
el('mbEmoji').textContent=score>=25?'\ud83c\udfc6':score>=15?'\ud83e\udd29':'\ud83e\uddee';
el('mbOverTitle').textContent=score>=20?'Math Genius!':'Nice try!';
el('mbOverSub').textContent=`You solved ${score} questions correctly.`;
el('mbFinalScore').textContent=score;
el('mbFinalHi').textContent=state.gameScores.mb;
showMbScreen('mbc-over');
}
function updateGameHiCards() {
const mem=state.gameScores.mem;
const cm=state.gameScores.cm;
const mb=state.gameScores.mb;
['memHiCard','memHiText'].forEach(id=>{ if(el(id)) el(id).textContent='Best: '+(mem?mem+' digits':'--'); });
['cmHiCard','cmHiText'].forEach(id=>{ if(el(id)) el(id).textContent='Best: '+(cm||'--'); });
['mbHiCard','mbHiText'].forEach(id=>{ if(el(id)) el(id).textContent='Best: '+(mb||'--'); });
}
const LEGAL={
privacy:`<h3>What we collect</h3><p>We collect only your email address when you create an account, and your focus session data (dates, durations, tasks). We never collect personal financial data or sell your information.</p><h3>How we use it</h3><p>Session data is used to show your streaks, history, and stats. Email is used only for authentication.</p><h3>Your rights</h3><p>You can delete your account and all data at any time by contacting getfocuzapp@gmail.com.</p><h3>Contact</h3><p>getfocuzapp@gmail.com</p>`,
terms:`<h3>Usage</h3><p>Focuz is free to use for personal productivity. Do not use it for harmful purposes.</p><h3>Data</h3><p>Guest mode data is stored locally and may be lost. Signed-in data is synced to secure servers.</p><h3>Disclaimer</h3><p>Focuz is provided as-is without warranty. We are not liable for data loss.</p><h3>Changes</h3><p>We may update these terms. Continued use means acceptance.</p>`
};
function showLegal(type) {
el('legalTitle').textContent=type==='privacy'?'Privacy Policy':'Terms of Use';
el('legalBody').innerHTML=LEGAL[type];
el('legalModal').classList.remove('hidden');
}
const OB_SLIDES=[
{ico:'\ud83c\udfaf',title:'Welcome to <span style="background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">focuz</span>',desc:'The deep work timer built to help you build a real focus habit -- not just count down a clock.<br><br>This quick guide shows you how everything works.'},
{ico:'\ud83d\udccb',title:'Add your tasks first',desc:'Before starting, add tasks in the <strong style="color:var(--violet)">Tasks</strong> section.<br><br>\ud83d\udd34 Set priority &nbsp;|&nbsp; \ud83d\udccc Tap to focus &nbsp;|&nbsp; \u2713 Tick when done'},
{ico:'\u23f1',title:'Start your timer',desc:'Pick 25, 45, 60, 90 min or custom -- then hit <strong style="color:var(--violet)">\u25b6 Play</strong>.<br><br>\ud83c\udf45 <strong style="color:var(--orange)">Pomodoro mode</strong> auto-gives you breaks after each session. Press <strong>Space bar</strong> to play/pause.'},
{ico:'\ud83c\udfa7',title:'Put your headphones on',desc:'<strong style="color:var(--teal)">Brown Noise</strong> blocks distractions and boosts deep focus.<br><br>Try Lo-fi, Rain or Fire based on your mood. The app even suggests the best beat for your task.'},
{ico:'\ud83d\udcc8',title:'Track your progress',desc:'Every session is saved automatically.<br>\ud83d\udcc5 Calendar &nbsp;|&nbsp; \ud83d\udcc8 7-day chart &nbsp;|&nbsp; \ud83d\udd25 Streak &nbsp;|&nbsp; \ud83c\udfc6 Badges &nbsp;|&nbsp; \ud83e\udde0 Brain games<br><br>Sign up free to sync across devices!'},
];
function renderOB() {
const wrap=el('ob-slides'), dotsWrap=el('obDots');
const s=OB_SLIDES[state.obStep];
wrap.innerHTML=`<div style="text-align:center">
<div style="font-size:54px;margin-bottom:18px">${s.ico}</div>
<div class="ob-title">${s.title}</div>
<div class="ob-desc">${s.desc}</div>
<button class="ob-next" id="obNextBtn">${state.obStep<OB_SLIDES.length-1?'Next ->':'Let\'s focus! \ud83d\ude80'}</button>
</div>`;
dotsWrap.innerHTML=OB_SLIDES.map((_,i)=>`<div class="ob-dot ${i===state.obStep?'on':''}"></div>`).join('');
el('obNextBtn').addEventListener('click',advanceOB);
}
function advanceOB() {
if(state.obStep<OB_SLIDES.length-1) { state.obStep++; renderOB(); }
else finishOB();
}
function finishOB() {
LS.set('obDone',true);
el('onboarding').classList.add('hidden');
if(state.user || state.isGuest) {
el('app').classList.add('active');
el('bottomNav').classList.remove('hidden');
observeReveals();
} else {
showAuth();
}
}
function startOnboarding() {
state.obStep=0;
renderOB();
el('onboarding').classList.remove('hidden');
}
const APP_URL='https://getfocuzapp.github.io/focuz';
const SHARE_TEXT=`I just finished a deep work session with Focuz! \ud83c\udfaf Building my focus habit one session at a time. Try it free -> ${APP_URL}`;
function copyLink() { navigator.clipboard.writeText(APP_URL).then(()=>toast('Link copied! \ud83d\udccb')).catch(()=>{}); }
function shareWA() { window.open(`https://wa.me/?text=${encodeURIComponent(SHARE_TEXT)}`,'_blank'); }
function shareTW() { window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(SHARE_TEXT)}`,'_blank'); }
function shareMore() {
if(navigator.share) { navigator.share({title:'Focuz -- Deep Work Timer',text:SHARE_TEXT,url:APP_URL}).catch(()=>{}); }
else { copyLink(); }
}
document.addEventListener('DOMContentLoaded', () => {
[el('landTheme'),el('appTheme'),el('settingsTheme')].forEach(btn=>{
if(btn) btn.addEventListener('click',toggleTheme);
});
[el('navCta'),el('heroCta'),el('heroCta2')].forEach(b=>{
if(b) b.addEventListener('click',()=>{
if(LS.get('obDone')) { showAuth(); }
else startOnboarding();
});
});
if(el('backBtn')) el('backBtn').addEventListener('click',showLanding);
if(el('tabIn')) el('tabIn').addEventListener('click',()=>setAuthMode('in'));
if(el('tabUp')) el('tabUp').addEventListener('click',()=>setAuthMode('up'));
if(el('authBg')) el('authBg').addEventListener('click',()=>{
if(state.user||state.isGuest) hideAuth();
});
if(el('authSubmit')) el('authSubmit').addEventListener('click',doAuth);
if(el('guestBtn')) el('guestBtn').addEventListener('click',continueAsGuest);
[el('authEmail'),el('authPass')].forEach(inp=>{
if(inp) inp.addEventListener('keydown',e=>{ if(e.key==='Enter') doAuth(); });
});
if(el('gbSignUp')) el('gbSignUp').addEventListener('click',showAuth);
if(el('topSignIn')) el('topSignIn').addEventListener('click',showAuth);
if(el('umSignOut')) el('umSignOut').addEventListener('click',signOut);
qsa('.bnav-item').forEach(btn=>{
btn.addEventListener('click',()=>switchTab(btn.dataset.tab));
});
if(el('playBtn')) el('playBtn').addEventListener('click', e=>{
ripple(el('playBtn'),e);
if(state.running) pauseTimer(); else startTimer();
});
if(el('resetBtn')) el('resetBtn').addEventListener('click',resetTimer);
if(el('skipBtn')) el('skipBtn').addEventListener('click',skipTimer);
document.addEventListener('keydown',e=>{
if(e.code==='Space' && e.target.tagName!=='INPUT' && e.target.tagName!=='TEXTAREA') {
e.preventDefault();
if(state.running) pauseTimer(); else startTimer();
}
});
if(el('presetsGrid')) el('presetsGrid').addEventListener('click',e=>{
const preset=e.target.closest('.preset');
if(!preset) return;
qsa('.preset').forEach(p=>p.classList.remove('on'));
preset.classList.add('on');
el('customMin').value='';
el('customRow').classList.remove('on');
setTimerMins(parseInt(preset.dataset.min));
});
if(el('customMin')) el('customMin').addEventListener('input',()=>{
const v=parseInt(el('customMin').value);
if(v>0&&v<=180) {
qsa('.preset').forEach(p=>p.classList.remove('on'));
el('customRow').classList.add('on');
setTimerMins(v);
}
});
if(el('soundGrid')) el('soundGrid').addEventListener('click',e=>{
const btn=e.target.closest('.sound-btn');
if(!btn) return;
qsa('.sound-btn').forEach(b=>b.classList.remove('on'));
btn.classList.add('on');
state.selectedSound=btn.dataset.sound;
LS.set('selectedSound',state.selectedSound);
if(state.running) { stopAmbient(); startAmbient(); }
});
if(el('soundSuggest')) el('soundSuggest').addEventListener('click',()=>{
const s=el('soundSuggest')._sound;
if(s) {
qsa('.sound-btn').forEach(b=>b.classList.toggle('on',b.dataset.sound===s));
state.selectedSound=s; LS.set('selectedSound',s);
if(state.running) { stopAmbient(); startAmbient(); }
el('soundSuggest').style.display='none';
toast('Sound updated! \ud83c\udfa7');
}
});
if(el('intentionIn')) el('intentionIn').addEventListener('input',updateIntentionUI);
if(el('togPomo')) {
el('togPomo').checked=state.pomodoroOn;
el('togPomo').addEventListener('change',()=>{
state.pomodoroOn=el('togPomo').checked;
LS.set('pomodoroOn',state.pomodoroOn);
updatePomoCycles();
});
}
if(el('togChime')) {
el('togChime').checked=state.chimeOn;
el('togChime').addEventListener('change',()=>{ state.chimeOn=el('togChime').checked; LS.set('chimeOn',state.chimeOn); });
}
if(el('togAmb')) {
el('togAmb').checked=state.ambientOn;
el('togAmb').addEventListener('change',()=>{
state.ambientOn=el('togAmb').checked;
LS.set('ambientOn',state.ambientOn);
if(!state.ambientOn) stopAmbient();
else if(state.running) startAmbient();
});
}
if(el('taskAddBtn')) el('taskAddBtn').addEventListener('click',addTask);
if(el('taskIn')) el('taskIn').addEventListener('keydown',e=>{ if(e.key==='Enter') addTask(); });
if(el('prioPicker')) el('prioPicker').addEventListener('click',e=>{
const chip=e.target.closest('.prio-chip');
if(!chip) return;
qsa('.prio-chip').forEach(c=>c.classList.remove('on'));
chip.classList.add('on');
selPrio=chip.dataset.p;
});
if(el('taskPanelHead')) el('taskPanelHead').addEventListener('click',()=>{
el('taskBody').classList.toggle('open');
el('taskToggle').classList.toggle('open');
});
if(el('coClose')) el('coClose').addEventListener('click',()=>{
el('completeOverlay').classList.remove('show');
resetTimer();
});
if(el('coDone')) el('coDone').addEventListener('click',()=>{
if(state.focusTaskId) {
const t=state.tasks.find(t=>t.id===state.focusTaskId);
if(t) { t.done=true; LS.set('tasks',state.tasks); updateTaskUI(); toast('Task marked done! \u2705'); }
}
el('completeOverlay').classList.remove('show');
resetTimer();
});
if(el('histHead')) el('histHead').addEventListener('click',()=>{
el('histBody').classList.toggle('open');
el('histArr').classList.toggle('open');
if(el('histBody').classList.contains('open')) renderCalendar();
});
if(el('calPrev')) el('calPrev').addEventListener('click',()=>{ state.calMonth.setMonth(state.calMonth.getMonth()-1); renderCalendar(); });
if(el('calNext')) el('calNext').addEventListener('click',()=>{ state.calMonth.setMonth(state.calMonth.getMonth()+1); renderCalendar(); });
if(el('weeklyBtn')) el('weeklyBtn').addEventListener('click',showWeeklyRecap);
if(el('wmClose')) el('wmClose').addEventListener('click',()=>el('weeklyModal').classList.add('hidden'));
if(el('wmBg')) el('wmBg').addEventListener('click',()=>el('weeklyModal').classList.add('hidden'));
if(el('recapShare')) el('recapShare').addEventListener('click',shareMore);
if(el('openMem')) el('openMem').addEventListener('click',()=>{ el('memModal').classList.remove('hidden'); showMemScreen('msc-start'); el('memHiText').textContent='Best: '+(state.gameScores.mem||'--')+' digits'; });
if(el('memClose')) el('memClose').addEventListener('click',()=>el('memModal').classList.add('hidden'));
if(el('memStart')) el('memStart').addEventListener('click',startMemGame);
if(el('memSubmit')) el('memSubmit').addEventListener('click',submitMem);
if(el('memIn')) el('memIn').addEventListener('keydown',e=>{ if(e.key==='Enter') submitMem(); });
if(el('memReplay')) el('memReplay').addEventListener('click',startMemGame);
if(el('memDone')) el('memDone').addEventListener('click',()=>el('memModal').classList.add('hidden'));
if(el('openCM')) el('openCM').addEventListener('click',()=>{ el('cmModal').classList.remove('hidden'); showCmScreen('cmc-start'); el('cmHiText').textContent='Best: '+(state.gameScores.cm||'--'); });
if(el('cmClose')) el('cmClose').addEventListener('click',()=>el('cmModal').classList.add('hidden'));
if(el('cmStart')) el('cmStart').addEventListener('click',startCM);
if(el('cmYes')) el('cmYes').addEventListener('click',()=>answerCM(true));
if(el('cmNo')) el('cmNo').addEventListener('click',()=>answerCM(false));
if(el('cmReplay')) el('cmReplay').addEventListener('click',startCM);
if(el('cmDone')) el('cmDone').addEventListener('click',()=>el('cmModal').classList.add('hidden'));
if(el('openMB')) el('openMB').addEventListener('click',()=>{ el('mbModal').classList.remove('hidden'); showMbScreen('mbc-start'); el('mbHiText').textContent='Best: '+(state.gameScores.mb||'--'); });
if(el('mbClose')) el('mbClose').addEventListener('click',()=>el('mbModal').classList.add('hidden'));
if(el('mbStart')) el('mbStart').addEventListener('click',startMB);
if(el('mbReplay')) el('mbReplay').addEventListener('click',startMB);
if(el('mbDone')) el('mbDone').addEventListener('click',()=>el('mbModal').classList.add('hidden'));
if(el('guideBtn')) el('guideBtn').addEventListener('click',()=>{
el('app').classList.remove('active');
el('bottomNav').classList.add('hidden');
startOnboarding();
});
if(el('copyRef')) el('copyRef').addEventListener('click',copyLink);
if(el('inWA')) el('inWA').addEventListener('click',shareWA);
if(el('inTW')) el('inTW').addEventListener('click',shareTW);
if(el('inMore')) el('inMore').addEventListener('click',shareMore);
if(el('tcTermsBtn')) el('tcTermsBtn').addEventListener('click',()=>showLegal('terms'));
if(el('tcPrivBtn'))  el('tcPrivBtn').addEventListener('click',()=>showLegal('privacy'));
[el('landPrivacy'),el('footPrivacy')].forEach(b=>{ if(b) b.addEventListener('click',()=>showLegal('privacy')); });
[el('landTerms'),el('footTerms')].forEach(b=>{ if(b) b.addEventListener('click',()=>showLegal('terms')); });
if(el('legalClose')) el('legalClose').addEventListener('click',()=>el('legalModal').classList.add('hidden'));
if(el('legalBg')) el('legalBg').addEventListener('click',()=>el('legalModal').classList.add('hidden'));
if(el('appLogo')) el('appLogo').addEventListener('click',showLanding);
window.addEventListener('beforeinstallprompt', e => {
e.preventDefault();
const banner = document.createElement('div');
banner.id = 'installBanner';
banner.style.cssText = 'position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--card);border:1.5px solid var(--violet);border-radius:var(--r-xl);padding:14px 20px;display:flex;align-items:center;gap:12px;z-index:300;box-shadow:0 8px 32px rgba(139,92,246,0.4);max-width:340px;width:calc(100% - 40px);animation:slideUp 0.4s var(--out);';
banner.innerHTML = '<span style="font-size:24px">\uD83D\uDCF2</span><div style="flex:1"><div style="font-weight:700;font-size:14px;color:var(--tx)">Install Focuz App</div><div style="font-size:11px;color:var(--tx3)">Add to home screen for the best experience</div></div><button id="installBannerClose" style="background:none;border:none;color:var(--tx3);font-size:18px;cursor:pointer;padding:4px">\u2715</button>';
const installBtn = document.createElement('button');
installBtn.textContent = 'Install';
installBtn.style.cssText = 'background:var(--gh);background-size:200%;animation:gFlow 5s ease infinite;border:none;border-radius:var(--r-pill);padding:8px 16px;font-family:var(--fB);font-size:12px;font-weight:700;color:#fff;cursor:pointer;white-space:nowrap;';
installBtn.onclick = async () => { await e.prompt(); banner.remove(); };
banner.querySelector('div').after(installBtn);
document.body.appendChild(banner);
document.getElementById('installBannerClose').onclick = () => banner.remove();
setTimeout(() => { if(banner.parentNode) banner.remove(); }, 15000); // auto-hide after 15s
});
buildViz();
loadQuote();
updateIntentionUI();
updatePomoCycles();
updateTaskUI();
updateGameHiCards();
setTimerMins(state.timerMins);
qsa('.sound-btn').forEach(b=>b.classList.toggle('on',b.dataset.sound===state.selectedSound));
if(sb) {
sb.auth.getSession().then(({data}) => {
if(data.session) {
// Returning user with valid session \u2014 go straight to app
state.user = data.session.user;
updateUserUI();
syncToCloud();
showApp();
} else {
// No session \u2014 clear any stale localStorage data and show landing
const theme = localStorage.getItem('focuz_theme');
localStorage.clear();
if(theme) localStorage.setItem('focuz_theme', theme);
state.sessions=[]; state.streak=0;
updateStats();
showLanding();
}
}).catch(() => { showLanding(); });
}
observeReveals();
}); // end DOMContentLoaded
</script>
</body>
</html>